{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///Users/christopheprat/Code/Side-projs/Hackathons/code-interview/src/app/voice/contexts/TranscriptContext.tsx"],"sourcesContent":["\"use client\";\n\nimport React, {\n  createContext,\n  useContext,\n  useState,\n  PropsWithChildren,\n} from \"react\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { TranscriptItem } from \"@/app/voice/types\";\n\ntype TranscriptContextValue = {\n  transcriptItems: TranscriptItem[];\n  addTranscriptMessage: (\n    itemId: string,\n    role: \"user\" | \"assistant\",\n    text: string,\n    isHidden?: boolean,\n  ) => void;\n  updateTranscriptMessage: (itemId: string, text: string, isDelta: boolean) => void;\n  addTranscriptBreadcrumb: (title: string, data?: Record<string, any>) => void;\n  toggleTranscriptItemExpand: (itemId: string) => void;\n};\n\nconst TranscriptContext = createContext<TranscriptContextValue | undefined>(\n  undefined,\n);\n\nexport function TranscriptProvider({ children }: PropsWithChildren) {\n  const [transcriptItems, setTranscriptItems] = useState<TranscriptItem[]>([]);\n\n  function newTimestampPretty(): string {\n    const now = new Date();\n    const time = now.toLocaleTimeString([], {\n      hour12: false,\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n      second: \"2-digit\",\n    });\n    const ms = now.getMilliseconds().toString().padStart(3, \"0\");\n    return `${time}.${ms}`;\n  }\n\n  const addTranscriptMessage: TranscriptContextValue[\"addTranscriptMessage\"] = (\n    itemId,\n    role,\n    text = \"\",\n    isHidden = false,\n  ) => {\n    setTranscriptItems((prev) => {\n      if (prev.some((item) => item.itemId === itemId)) {\n        return prev;\n      }\n\n      const newItem: TranscriptItem = {\n        itemId,\n        type: \"MESSAGE\",\n        role,\n        title: text,\n        data: undefined,\n        expanded: false,\n        timestamp: newTimestampPretty(),\n        createdAtMs: Date.now(),\n        status: \"IN_PROGRESS\",\n        isHidden,\n      };\n\n      return [...prev, newItem];\n    });\n  };\n\n  const updateTranscriptMessage: TranscriptContextValue[\"updateTranscriptMessage\"] = (\n    itemId,\n    newText,\n    append,\n  ) => {\n    setTranscriptItems((prev) =>\n      prev.map((item) =>\n        item.itemId === itemId && item.type === \"MESSAGE\"\n          ? {\n              ...item,\n              title: append ? `${item.title ?? \"\"}${newText}` : newText,\n              status: \"DONE\",\n            }\n          : item,\n      ),\n    );\n  };\n\n  const addTranscriptBreadcrumb: TranscriptContextValue[\"addTranscriptBreadcrumb\"] = (\n    title,\n    data,\n  ) => {\n    setTranscriptItems((prev) => [\n      ...prev,\n      {\n        itemId: `breadcrumb-${uuidv4()}`,\n        type: \"BREADCRUMB\",\n        title,\n        data,\n        expanded: false,\n        timestamp: newTimestampPretty(),\n        createdAtMs: Date.now(),\n        status: \"DONE\",\n        isHidden: false,\n      },\n    ]);\n  };\n\n  const toggleTranscriptItemExpand: TranscriptContextValue[\"toggleTranscriptItemExpand\"] = (\n    itemId,\n  ) => {\n    setTranscriptItems((prev) =>\n      prev.map((item) =>\n        item.itemId === itemId\n          ? { ...item, expanded: !item.expanded }\n          : item,\n      ),\n    );\n  };\n\n  return (\n    <TranscriptContext.Provider\n      value={{\n        transcriptItems,\n        addTranscriptMessage,\n        updateTranscriptMessage,\n        addTranscriptBreadcrumb,\n        toggleTranscriptItemExpand,\n      }}\n    >\n      {children}\n    </TranscriptContext.Provider>\n  );\n}\n\nexport function useTranscript() {\n  const ctx = useContext(TranscriptContext);\n  if (!ctx) {\n    throw new Error(\"useTranscript must be used within a TranscriptProvider\");\n  }\n  return ctx;\n}\n"],"names":[],"mappings":";;;;;;;AAEA;;;;;;AAFA;;;;AAwBA,MAAM,kCAAoB,IAAA,6XAAa,EACrC;AAGK,SAAS,mBAAmB,EAAE,QAAQ,EAAqB;IAChE,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,wXAAQ,EAAmB,EAAE;IAE3E,SAAS;QACP,MAAM,MAAM,IAAI;QAChB,MAAM,OAAO,IAAI,kBAAkB,CAAC,EAAE,EAAE;YACtC,QAAQ;YACR,MAAM;YACN,QAAQ;YACR,QAAQ;QACV;QACA,MAAM,KAAK,IAAI,eAAe,GAAG,QAAQ,GAAG,QAAQ,CAAC,GAAG;QACxD,OAAO,GAAG,KAAK,CAAC,EAAE,IAAI;IACxB;IAEA,MAAM,uBAAuE,CAC3E,QACA,MACA,OAAO,EAAE,EACT,WAAW,KAAK;QAEhB,mBAAmB,CAAC;YAClB,IAAI,KAAK,IAAI,CAAC,CAAC,OAAS,KAAK,MAAM,KAAK,SAAS;gBAC/C,OAAO;YACT;YAEA,MAAM,UAA0B;gBAC9B;gBACA,MAAM;gBACN;gBACA,OAAO;gBACP,MAAM;gBACN,UAAU;gBACV,WAAW;gBACX,aAAa,KAAK,GAAG;gBACrB,QAAQ;gBACR;YACF;YAEA,OAAO;mBAAI;gBAAM;aAAQ;QAC3B;IACF;IAEA,MAAM,0BAA6E,CACjF,QACA,SACA;QAEA,mBAAmB,CAAC,OAClB,KAAK,GAAG,CAAC,CAAC,OACR,KAAK,MAAM,KAAK,UAAU,KAAK,IAAI,KAAK,YACpC;oBACE,GAAG,IAAI;oBACP,OAAO,SAAS,GAAG,KAAK,KAAK,IAAI,KAAK,SAAS,GAAG;oBAClD,QAAQ;gBACV,IACA;IAGV;IAEA,MAAM,0BAA6E,CACjF,OACA;QAEA,mBAAmB,CAAC,OAAS;mBACxB;gBACH;oBACE,QAAQ,CAAC,WAAW,EAAE,UAAU;oBAChC,MAAM;oBACN;oBACA;oBACA,UAAU;oBACV,WAAW;oBACX,aAAa,KAAK,GAAG;oBACrB,QAAQ;oBACR,UAAU;gBACZ;aACD;IACH;IAEA,MAAM,6BAAmF,CACvF;QAEA,mBAAmB,CAAC,OAClB,KAAK,GAAG,CAAC,CAAC,OACR,KAAK,MAAM,KAAK,SACZ;oBAAE,GAAG,IAAI;oBAAE,UAAU,CAAC,KAAK,QAAQ;gBAAC,IACpC;IAGV;IAEA,qBACE,qZAAC,kBAAkB,QAAQ;QACzB,OAAO;YACL;YACA;YACA;YACA;YACA;QACF;kBAEC;;;;;;AAGP;AAEO,SAAS;IACd,MAAM,MAAM,IAAA,0XAAU,EAAC;IACvB,IAAI,CAAC,KAAK;QACR,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 119, "column": 0}, "map": {"version":3,"sources":["file:///Users/christopheprat/Code/Side-projs/Hackathons/code-interview/src/app/voice/contexts/EventContext.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { createContext, useContext, useState, PropsWithChildren } from \"react\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { LoggedEvent } from \"@/app/voice/types\";\n\ntype EventContextValue = {\n  loggedEvents: LoggedEvent[];\n  logClientEvent: (eventObj: Record<string, any>, eventNameSuffix?: string) => void;\n  logServerEvent: (eventObj: Record<string, any>, eventNameSuffix?: string) => void;\n  toggleExpand: (id: string) => void;\n};\n\nconst EventContext = createContext<EventContextValue | undefined>(undefined);\n\nexport function EventProvider({ children }: PropsWithChildren) {\n  const [loggedEvents, setLoggedEvents] = useState<LoggedEvent[]>([]);\n\n  function addLoggedEvent(direction: \"client\" | \"server\", name: string, data: Record<string, any>) {\n    const id = data.event_id || uuidv4();\n    setLoggedEvents((prev) => [\n      ...prev,\n      {\n        id,\n        direction,\n        eventName: name,\n        eventData: data,\n        timestamp: new Date().toLocaleTimeString(),\n        expanded: false,\n      },\n    ]);\n  }\n\n  const logClientEvent: EventContextValue[\"logClientEvent\"] = (eventObj, suffix = \"\") => {\n    const name = `${eventObj.type || \"\"} ${suffix}`.trim();\n    addLoggedEvent(\"client\", name, eventObj);\n  };\n\n  const logServerEvent: EventContextValue[\"logServerEvent\"] = (eventObj, suffix = \"\") => {\n    const name = `${eventObj.type || \"\"} ${suffix}`.trim();\n    addLoggedEvent(\"server\", name, eventObj);\n  };\n\n  const toggleExpand: EventContextValue[\"toggleExpand\"] = (id) => {\n    setLoggedEvents((prev) =>\n      prev.map((item) =>\n        item.id === id ? { ...item, expanded: !item.expanded } : item,\n      ),\n    );\n  };\n\n  return (\n    <EventContext.Provider value={{ loggedEvents, logClientEvent, logServerEvent, toggleExpand }}>\n      {children}\n    </EventContext.Provider>\n  );\n}\n\nexport function useEvent() {\n  const ctx = useContext(EventContext);\n  if (!ctx) {\n    throw new Error(\"useEvent must be used within an EventProvider\");\n  }\n  return ctx;\n}\n"],"names":[],"mappings":";;;;;;;AAEA;;;;;;AAFA;;;;AAaA,MAAM,6BAAe,IAAA,6XAAa,EAAgC;AAE3D,SAAS,cAAc,EAAE,QAAQ,EAAqB;IAC3D,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,wXAAQ,EAAgB,EAAE;IAElE,SAAS,eAAe,SAA8B,EAAE,IAAY,EAAE,IAAyB;QAC7F,MAAM,KAAK,KAAK,QAAQ,IAAI;QAC5B,gBAAgB,CAAC,OAAS;mBACrB;gBACH;oBACE;oBACA;oBACA,WAAW;oBACX,WAAW;oBACX,WAAW,IAAI,OAAO,kBAAkB;oBACxC,UAAU;gBACZ;aACD;IACH;IAEA,MAAM,iBAAsD,CAAC,UAAU,SAAS,EAAE;QAChF,MAAM,OAAO,GAAG,SAAS,IAAI,IAAI,GAAG,CAAC,EAAE,QAAQ,CAAC,IAAI;QACpD,eAAe,UAAU,MAAM;IACjC;IAEA,MAAM,iBAAsD,CAAC,UAAU,SAAS,EAAE;QAChF,MAAM,OAAO,GAAG,SAAS,IAAI,IAAI,GAAG,CAAC,EAAE,QAAQ,CAAC,IAAI;QACpD,eAAe,UAAU,MAAM;IACjC;IAEA,MAAM,eAAkD,CAAC;QACvD,gBAAgB,CAAC,OACf,KAAK,GAAG,CAAC,CAAC,OACR,KAAK,EAAE,KAAK,KAAK;oBAAE,GAAG,IAAI;oBAAE,UAAU,CAAC,KAAK,QAAQ;gBAAC,IAAI;IAG/D;IAEA,qBACE,qZAAC,aAAa,QAAQ;QAAC,OAAO;YAAE;YAAc;YAAgB;YAAgB;QAAa;kBACxF;;;;;;AAGP;AAEO,SAAS;IACd,MAAM,MAAM,IAAA,0XAAU,EAAC;IACvB,IAAI,CAAC,KAAK;QACR,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 321, "column": 0}, "map": {"version":3,"sources":["file:///Users/christopheprat/Code/Side-projs/Hackathons/code-interview/src/app/voice/lib/codecUtils.ts"],"sourcesContent":["export function audioFormatForCodec(codec: string): \"pcm16\" | \"g711_ulaw\" | \"g711_alaw\" {\n  const lower = codec.toLowerCase();\n  if (lower === \"pcmu\") return \"g711_ulaw\";\n  if (lower === \"pcma\") return \"g711_alaw\";\n  return \"pcm16\";\n}\n\nexport function applyCodecPreferences(\n  pc: RTCPeerConnection,\n  codec: string,\n): void {\n  try {\n    const capabilities = (RTCRtpSender as any).getCapabilities?.(\"audio\");\n    if (!capabilities) return;\n\n    const target = capabilities.codecs.find(\n      (c: any) => c.mimeType.toLowerCase() === `audio/${codec.toLowerCase()}`,\n    );\n    if (!target) return;\n\n    pc\n      .getTransceivers()\n      .filter((t) => t.sender && t.sender.track?.kind === \"audio\")\n      .forEach((t) => t.setCodecPreferences([target]));\n  } catch (err) {\n    console.error(\"Failed to apply codec preferences\", err);\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAO,SAAS,oBAAoB,KAAa;IAC/C,MAAM,QAAQ,MAAM,WAAW;IAC/B,IAAI,UAAU,QAAQ,OAAO;IAC7B,IAAI,UAAU,QAAQ,OAAO;IAC7B,OAAO;AACT;AAEO,SAAS,sBACd,EAAqB,EACrB,KAAa;IAEb,IAAI;QACF,MAAM,eAAe,AAAC,aAAqB,eAAe,GAAG;QAC7D,IAAI,CAAC,cAAc;QAEnB,MAAM,SAAS,aAAa,MAAM,CAAC,IAAI,CACrC,CAAC,IAAW,EAAE,QAAQ,CAAC,WAAW,OAAO,CAAC,MAAM,EAAE,MAAM,WAAW,IAAI;QAEzE,IAAI,CAAC,QAAQ;QAEb,GACG,eAAe,GACf,MAAM,CAAC,CAAC,IAAM,EAAE,MAAM,IAAI,EAAE,MAAM,CAAC,KAAK,EAAE,SAAS,SACnD,OAAO,CAAC,CAAC,IAAM,EAAE,mBAAmB,CAAC;gBAAC;aAAO;IAClD,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,qCAAqC;IACrD;AACF","debugId":null}},
    {"offset": {"line": 350, "column": 0}, "map": {"version":3,"sources":["file:///Users/christopheprat/Code/Side-projs/Hackathons/code-interview/src/app/voice/hooks/useHandleSessionHistory.ts"],"sourcesContent":["\"use client\";\n\nimport { useRef } from \"react\";\nimport { useTranscript } from \"@/app/voice/contexts/TranscriptContext\";\nimport { useEvent } from \"@/app/voice/contexts/EventContext\";\n\nexport function useHandleSessionHistory() {\n  const {\n    addTranscriptBreadcrumb,\n    addTranscriptMessage,\n    updateTranscriptMessage,\n  } = useTranscript();\n  const { logServerEvent } = useEvent();\n\n  const extractMessageText = (content: any[] = []): string => {\n    if (!Array.isArray(content)) return \"\";\n    return content\n      .map((item) => {\n        if (!item || typeof item !== \"object\") return \"\";\n        if (item.type === \"input_text\") return item.text ?? \"\";\n        if (item.type === \"output_text\") return item.text ?? \"\";\n        if (item.type === \"audio\") return item.transcript ?? \"\";\n        return \"\";\n      })\n      .filter(Boolean)\n      .join(\"\\n\");\n  };\n\n  function handleHistoryAdded(item: any) {\n    if (!item || item.type !== \"message\") return;\n    const { itemId, role, content = [] } = item;\n    if (!itemId || !role) return;\n\n    const text = extractMessageText(content) || \"\";\n    addTranscriptMessage(itemId, role, text || (role === \"user\" ? \"[Listening...]\" : \"\"));\n  }\n\n  function handleHistoryUpdated(items: any[]) {\n    items.forEach((item) => {\n      if (!item || item.type !== \"message\") return;\n      const { itemId, content = [] } = item;\n      if (!itemId) return;\n\n      const text = extractMessageText(content);\n      if (text) {\n        updateTranscriptMessage(itemId, text, false);\n      }\n    });\n  }\n\n  function handleTranscriptionDelta(event: any) {\n    const itemId = event.item_id;\n    const deltaText = event.delta || \"\";\n    if (itemId && deltaText) {\n      updateTranscriptMessage(itemId, deltaText, true);\n    }\n  }\n\n  function handleTranscriptionCompleted(event: any) {\n    const itemId = event.item_id;\n    const finalTranscript = event.transcript || \"\";\n    if (itemId) {\n      updateTranscriptMessage(itemId, finalTranscript || \"[inaudible]\", false);\n    }\n  }\n\n  function handleTransportEvent(event: any) {\n    logServerEvent(event);\n  }\n\n  const handlersRef = useRef({\n    handleHistoryAdded,\n    handleHistoryUpdated,\n    handleTranscriptionDelta,\n    handleTranscriptionCompleted,\n    handleTransportEvent,\n    addTranscriptBreadcrumb,\n  });\n\n  return handlersRef;\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAJA;;;;AAMO,SAAS;IACd,MAAM,EACJ,uBAAuB,EACvB,oBAAoB,EACpB,uBAAuB,EACxB,GAAG,IAAA,sKAAa;IACjB,MAAM,EAAE,cAAc,EAAE,GAAG,IAAA,4JAAQ;IAEnC,MAAM,qBAAqB,CAAC,UAAiB,EAAE;QAC7C,IAAI,CAAC,MAAM,OAAO,CAAC,UAAU,OAAO;QACpC,OAAO,QACJ,GAAG,CAAC,CAAC;YACJ,IAAI,CAAC,QAAQ,OAAO,SAAS,UAAU,OAAO;YAC9C,IAAI,KAAK,IAAI,KAAK,cAAc,OAAO,KAAK,IAAI,IAAI;YACpD,IAAI,KAAK,IAAI,KAAK,eAAe,OAAO,KAAK,IAAI,IAAI;YACrD,IAAI,KAAK,IAAI,KAAK,SAAS,OAAO,KAAK,UAAU,IAAI;YACrD,OAAO;QACT,GACC,MAAM,CAAC,SACP,IAAI,CAAC;IACV;IAEA,SAAS,mBAAmB,IAAS;QACnC,IAAI,CAAC,QAAQ,KAAK,IAAI,KAAK,WAAW;QACtC,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,UAAU,EAAE,EAAE,GAAG;QACvC,IAAI,CAAC,UAAU,CAAC,MAAM;QAEtB,MAAM,OAAO,mBAAmB,YAAY;QAC5C,qBAAqB,QAAQ,MAAM,QAAQ,CAAC,SAAS,SAAS,mBAAmB,EAAE;IACrF;IAEA,SAAS,qBAAqB,KAAY;QACxC,MAAM,OAAO,CAAC,CAAC;YACb,IAAI,CAAC,QAAQ,KAAK,IAAI,KAAK,WAAW;YACtC,MAAM,EAAE,MAAM,EAAE,UAAU,EAAE,EAAE,GAAG;YACjC,IAAI,CAAC,QAAQ;YAEb,MAAM,OAAO,mBAAmB;YAChC,IAAI,MAAM;gBACR,wBAAwB,QAAQ,MAAM;YACxC;QACF;IACF;IAEA,SAAS,yBAAyB,KAAU;QAC1C,MAAM,SAAS,MAAM,OAAO;QAC5B,MAAM,YAAY,MAAM,KAAK,IAAI;QACjC,IAAI,UAAU,WAAW;YACvB,wBAAwB,QAAQ,WAAW;QAC7C;IACF;IAEA,SAAS,6BAA6B,KAAU;QAC9C,MAAM,SAAS,MAAM,OAAO;QAC5B,MAAM,kBAAkB,MAAM,UAAU,IAAI;QAC5C,IAAI,QAAQ;YACV,wBAAwB,QAAQ,mBAAmB,eAAe;QACpE;IACF;IAEA,SAAS,qBAAqB,KAAU;QACtC,eAAe;IACjB;IAEA,MAAM,cAAc,IAAA,sXAAM,EAAC;QACzB;QACA;QACA;QACA;QACA;QACA;IACF;IAEA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 423, "column": 0}, "map": {"version":3,"sources":["file:///Users/christopheprat/Code/Side-projs/Hackathons/code-interview/src/app/voice/hooks/useRealtimeSession.ts"],"sourcesContent":["import { useCallback, useRef, useState } from \"react\";\nimport {\n  RealtimeSession,\n  RealtimeAgent,\n  OpenAIRealtimeWebRTC,\n} from \"@openai/agents/realtime\";\n\nimport { audioFormatForCodec, applyCodecPreferences } from \"@/app/voice/lib/codecUtils\";\nimport { useEvent } from \"@/app/voice/contexts/EventContext\";\nimport { useHandleSessionHistory } from \"@/app/voice/hooks/useHandleSessionHistory\";\nimport { SessionStatus } from \"@/app/voice/types\";\n\nexport interface RealtimeSessionCallbacks {\n  onConnectionChange?: (status: SessionStatus) => void;\n}\n\ninterface ConnectOptions {\n  getEphemeralKey: () => Promise<string>;\n  agent: RealtimeAgent;\n  audioElement?: HTMLAudioElement;\n  extraContext?: Record<string, any>;\n}\n\nexport function useRealtimeSession(callbacks: RealtimeSessionCallbacks = {}) {\n  const sessionRef = useRef<RealtimeSession | null>(null);\n  const [status, setStatus] = useState<SessionStatus>(\"DISCONNECTED\");\n  const { logClientEvent, logServerEvent } = useEvent();\n  const historyHandlersRef = useHandleSessionHistory();\n\n  const updateStatus = useCallback(\n    (next: SessionStatus) => {\n      setStatus(next);\n      callbacks.onConnectionChange?.(next);\n      logClientEvent({ type: \"status_change\", value: next });\n    },\n    [callbacks],\n  );\n\n  const connect = useCallback(\n    async ({ getEphemeralKey, agent, audioElement, extraContext }: ConnectOptions) => {\n      if (sessionRef.current) return;\n\n      updateStatus(\"CONNECTING\");\n      const key = await getEphemeralKey();\n\n      const codec =\n        typeof window !== \"undefined\"\n          ? new URLSearchParams(window.location.search).get(\"codec\") ?? \"opus\"\n          : \"opus\";\n      const audioFormat = audioFormatForCodec(codec);\n\n      const session = new RealtimeSession(agent, {\n        transport: new OpenAIRealtimeWebRTC({\n          audioElement,\n          changePeerConnection: async (pc: RTCPeerConnection) => {\n            applyCodecPreferences(pc, codec);\n            return pc;\n          },\n        }),\n        model: \"gpt-4o-realtime-preview-2025-06-03\",\n        config: {\n          inputAudioFormat: audioFormat,\n          outputAudioFormat: audioFormat,\n          inputAudioTranscription: {\n            model: \"gpt-4o-mini-transcribe\",\n          },\n        },\n        context: extraContext ?? {},\n      });\n\n      session.on(\"connected\", () => logServerEvent({ type: \"connected\" }));\n      session.on(\"disconnected\", () => logServerEvent({ type: \"disconnected\" }));\n      session.on(\"error\", (err) => {\n        logServerEvent({ type: \"error\", error: err });\n      });\n\n      session.on(\"history_added\", (item) => {\n        historyHandlersRef.current.handleHistoryAdded(item);\n      });\n      session.on(\"history_updated\", (items) => {\n        historyHandlersRef.current.handleHistoryUpdated(items);\n      });\n      session.on(\"agent_output_created\", (event) => {\n        historyHandlersRef.current.handleTransportEvent(event);\n      });\n      session.on(\"transport_event\", (event) => {\n        switch (event.type) {\n          case \"conversation.item.input_audio_transcription.delta\":\n            historyHandlersRef.current.handleTranscriptionDelta(event);\n            break;\n          case \"conversation.item.input_audio_transcription.completed\":\n          case \"response.audio_transcript.done\":\n            historyHandlersRef.current.handleTranscriptionCompleted(event);\n            break;\n          default:\n            historyHandlersRef.current.handleTransportEvent(event);\n        }\n      });\n\n      sessionRef.current = session;\n      await session.connect({ apiKey: key });\n      updateStatus(\"CONNECTED\");\n    },\n    [callbacks, updateStatus, historyHandlersRef],\n  );\n\n  const disconnect = useCallback(() => {\n    sessionRef.current?.close();\n    sessionRef.current = null;\n    updateStatus(\"DISCONNECTED\");\n  }, [updateStatus]);\n\n  const interrupt = useCallback(() => {\n    sessionRef.current?.interrupt();\n  }, []);\n\n  const sendUserText = useCallback((text: string) => {\n    if (!sessionRef.current) throw new Error(\"Session not connected\");\n    sessionRef.current.sendMessage(text);\n  }, []);\n\n  const sendEvent = useCallback((event: any) => {\n    sessionRef.current?.transport.sendEvent(event);\n  }, []);\n\n  const mute = useCallback((shouldMute: boolean) => {\n    sessionRef.current?.mute(shouldMute);\n  }, []);\n\n  return {\n    status,\n    connect,\n    disconnect,\n    sendUserText,\n    sendEvent,\n    mute,\n    interrupt,\n  } as const;\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 555, "column": 0}, "map": {"version":3,"sources":["file:///Users/christopheprat/Code/Side-projs/Hackathons/code-interview/src/app/voice/lib/audioUtils.ts"],"sourcesContent":["export function writeString(view: DataView, offset: number, str: string) {\n  for (let i = 0; i < str.length; i++) {\n    view.setUint8(offset + i, str.charCodeAt(i));\n  }\n}\n\nexport function floatTo16BitPCM(output: DataView, offset: number, input: Float32Array) {\n  for (let i = 0; i < input.length; i++, offset += 2) {\n    const s = Math.max(-1, Math.min(1, input[i]));\n    output.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7fff, true);\n  }\n}\n\nexport function encodeWAV(samples: Float32Array, sampleRate: number): ArrayBuffer {\n  const buffer = new ArrayBuffer(44 + samples.length * 2);\n  const view = new DataView(buffer);\n\n  writeString(view, 0, \"RIFF\");\n  view.setUint32(4, 36 + samples.length * 2, true);\n  writeString(view, 8, \"WAVE\");\n  writeString(view, 12, \"fmt \");\n  view.setUint32(16, 16, true);\n  view.setUint16(20, 1, true);\n  view.setUint16(22, 1, true);\n  view.setUint32(24, sampleRate, true);\n  view.setUint32(28, sampleRate * 2, true);\n  view.setUint16(32, 2, true);\n  view.setUint16(34, 16, true);\n  writeString(view, 36, \"data\");\n  view.setUint32(40, samples.length * 2, true);\n\n  floatTo16BitPCM(view, 44, samples);\n\n  return buffer;\n}\n\nexport async function convertWebMBlobToWav(blob: Blob): Promise<Blob> {\n  const arrayBuffer = await blob.arrayBuffer();\n  const audioContext = new AudioContext();\n  const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);\n  const numChannels = audioBuffer.numberOfChannels;\n  const length = audioBuffer.length;\n  const combined = new Float32Array(length);\n\n  for (let channel = 0; channel < numChannels; channel++) {\n    const channelData = audioBuffer.getChannelData(channel);\n    for (let i = 0; i < length; i++) {\n      combined[i] += channelData[i];\n    }\n  }\n\n  for (let i = 0; i < length; i++) {\n    combined[i] /= numChannels;\n  }\n\n  const wavBuffer = encodeWAV(combined, audioBuffer.sampleRate);\n  return new Blob([wavBuffer], { type: \"audio/wav\" });\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAO,SAAS,YAAY,IAAc,EAAE,MAAc,EAAE,GAAW;IACrE,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,MAAM,EAAE,IAAK;QACnC,KAAK,QAAQ,CAAC,SAAS,GAAG,IAAI,UAAU,CAAC;IAC3C;AACF;AAEO,SAAS,gBAAgB,MAAgB,EAAE,MAAc,EAAE,KAAmB;IACnF,IAAK,IAAI,IAAI,GAAG,IAAI,MAAM,MAAM,EAAE,KAAK,UAAU,EAAG;QAClD,MAAM,IAAI,KAAK,GAAG,CAAC,CAAC,GAAG,KAAK,GAAG,CAAC,GAAG,KAAK,CAAC,EAAE;QAC3C,OAAO,QAAQ,CAAC,QAAQ,IAAI,IAAI,IAAI,SAAS,IAAI,QAAQ;IAC3D;AACF;AAEO,SAAS,UAAU,OAAqB,EAAE,UAAkB;IACjE,MAAM,SAAS,IAAI,YAAY,KAAK,QAAQ,MAAM,GAAG;IACrD,MAAM,OAAO,IAAI,SAAS;IAE1B,YAAY,MAAM,GAAG;IACrB,KAAK,SAAS,CAAC,GAAG,KAAK,QAAQ,MAAM,GAAG,GAAG;IAC3C,YAAY,MAAM,GAAG;IACrB,YAAY,MAAM,IAAI;IACtB,KAAK,SAAS,CAAC,IAAI,IAAI;IACvB,KAAK,SAAS,CAAC,IAAI,GAAG;IACtB,KAAK,SAAS,CAAC,IAAI,GAAG;IACtB,KAAK,SAAS,CAAC,IAAI,YAAY;IAC/B,KAAK,SAAS,CAAC,IAAI,aAAa,GAAG;IACnC,KAAK,SAAS,CAAC,IAAI,GAAG;IACtB,KAAK,SAAS,CAAC,IAAI,IAAI;IACvB,YAAY,MAAM,IAAI;IACtB,KAAK,SAAS,CAAC,IAAI,QAAQ,MAAM,GAAG,GAAG;IAEvC,gBAAgB,MAAM,IAAI;IAE1B,OAAO;AACT;AAEO,eAAe,qBAAqB,IAAU;IACnD,MAAM,cAAc,MAAM,KAAK,WAAW;IAC1C,MAAM,eAAe,IAAI;IACzB,MAAM,cAAc,MAAM,aAAa,eAAe,CAAC;IACvD,MAAM,cAAc,YAAY,gBAAgB;IAChD,MAAM,SAAS,YAAY,MAAM;IACjC,MAAM,WAAW,IAAI,aAAa;IAElC,IAAK,IAAI,UAAU,GAAG,UAAU,aAAa,UAAW;QACtD,MAAM,cAAc,YAAY,cAAc,CAAC;QAC/C,IAAK,IAAI,IAAI,GAAG,IAAI,QAAQ,IAAK;YAC/B,QAAQ,CAAC,EAAE,IAAI,WAAW,CAAC,EAAE;QAC/B;IACF;IAEA,IAAK,IAAI,IAAI,GAAG,IAAI,QAAQ,IAAK;QAC/B,QAAQ,CAAC,EAAE,IAAI;IACjB;IAEA,MAAM,YAAY,UAAU,UAAU,YAAY,UAAU;IAC5D,OAAO,IAAI,KAAK;QAAC;KAAU,EAAE;QAAE,MAAM;IAAY;AACnD","debugId":null}},
    {"offset": {"line": 622, "column": 0}, "map": {"version":3,"sources":["file:///Users/christopheprat/Code/Side-projs/Hackathons/code-interview/src/app/voice/hooks/useAudioDownload.ts"],"sourcesContent":["import { useRef } from \"react\";\nimport { convertWebMBlobToWav } from \"@/app/voice/lib/audioUtils\";\n\nfunction useAudioDownload() {\n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\n  const recordedChunksRef = useRef<Blob[]>([]);\n\n  const startRecording = async (remoteStream: MediaStream) => {\n    let micStream: MediaStream;\n    try {\n      micStream = await navigator.mediaDevices.getUserMedia({ audio: true });\n    } catch (err) {\n      console.error(\"Error getting microphone stream:\", err);\n      micStream = new MediaStream();\n    }\n\n    const audioContext = new AudioContext();\n    const destination = audioContext.createMediaStreamDestination();\n\n    try {\n      const remoteSource = audioContext.createMediaStreamSource(remoteStream);\n      remoteSource.connect(destination);\n    } catch (err) {\n      console.error(\"Unable to connect remote stream:\", err);\n    }\n\n    try {\n      const micSource = audioContext.createMediaStreamSource(micStream);\n      micSource.connect(destination);\n    } catch (err) {\n      console.error(\"Unable to connect microphone stream:\", err);\n    }\n\n    const options = { mimeType: \"audio/webm\" };\n    try {\n      const mediaRecorder = new MediaRecorder(destination.stream, options);\n      mediaRecorder.ondataavailable = (event: BlobEvent) => {\n        if (event.data && event.data.size > 0) {\n          recordedChunksRef.current.push(event.data);\n        }\n      };\n      mediaRecorder.start();\n      mediaRecorderRef.current = mediaRecorder;\n    } catch (err) {\n      console.error(\"Error starting MediaRecorder:\", err);\n    }\n  };\n\n  const stopRecording = () => {\n    if (!mediaRecorderRef.current) return;\n    mediaRecorderRef.current.requestData();\n    mediaRecorderRef.current.stop();\n    mediaRecorderRef.current = null;\n  };\n\n  const downloadRecording = async () => {\n    if (mediaRecorderRef.current?.state === \"recording\") {\n      mediaRecorderRef.current.requestData();\n      await new Promise((resolve) => setTimeout(resolve, 100));\n    }\n\n    if (recordedChunksRef.current.length === 0) {\n      console.warn(\"No recorded audio chunks available\");\n      return;\n    }\n\n    const webmBlob = new Blob(recordedChunksRef.current, {\n      type: \"audio/webm\",\n    });\n\n    try {\n      const wavBlob = await convertWebMBlobToWav(webmBlob);\n      const url = URL.createObjectURL(wavBlob);\n      const now = new Date().toISOString().replace(/[:.]/g, \"-\");\n\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = `voice-agent-${now}.wav`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      setTimeout(() => URL.revokeObjectURL(url), 100);\n    } catch (err) {\n      console.error(\"Failed to convert WebM to WAV:\", err);\n    }\n  };\n\n  return { startRecording, stopRecording, downloadRecording };\n}\n\nexport default useAudioDownload;\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,SAAS;IACP,MAAM,mBAAmB,IAAA,sXAAM,EAAuB;IACtD,MAAM,oBAAoB,IAAA,sXAAM,EAAS,EAAE;IAE3C,MAAM,iBAAiB,OAAO;QAC5B,IAAI;QACJ,IAAI;YACF,YAAY,MAAM,UAAU,YAAY,CAAC,YAAY,CAAC;gBAAE,OAAO;YAAK;QACtE,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,oCAAoC;YAClD,YAAY,IAAI;QAClB;QAEA,MAAM,eAAe,IAAI;QACzB,MAAM,cAAc,aAAa,4BAA4B;QAE7D,IAAI;YACF,MAAM,eAAe,aAAa,uBAAuB,CAAC;YAC1D,aAAa,OAAO,CAAC;QACvB,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,oCAAoC;QACpD;QAEA,IAAI;YACF,MAAM,YAAY,aAAa,uBAAuB,CAAC;YACvD,UAAU,OAAO,CAAC;QACpB,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,wCAAwC;QACxD;QAEA,MAAM,UAAU;YAAE,UAAU;QAAa;QACzC,IAAI;YACF,MAAM,gBAAgB,IAAI,cAAc,YAAY,MAAM,EAAE;YAC5D,cAAc,eAAe,GAAG,CAAC;gBAC/B,IAAI,MAAM,IAAI,IAAI,MAAM,IAAI,CAAC,IAAI,GAAG,GAAG;oBACrC,kBAAkB,OAAO,CAAC,IAAI,CAAC,MAAM,IAAI;gBAC3C;YACF;YACA,cAAc,KAAK;YACnB,iBAAiB,OAAO,GAAG;QAC7B,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,iCAAiC;QACjD;IACF;IAEA,MAAM,gBAAgB;QACpB,IAAI,CAAC,iBAAiB,OAAO,EAAE;QAC/B,iBAAiB,OAAO,CAAC,WAAW;QACpC,iBAAiB,OAAO,CAAC,IAAI;QAC7B,iBAAiB,OAAO,GAAG;IAC7B;IAEA,MAAM,oBAAoB;QACxB,IAAI,iBAAiB,OAAO,EAAE,UAAU,aAAa;YACnD,iBAAiB,OAAO,CAAC,WAAW;YACpC,MAAM,IAAI,QAAQ,CAAC,UAAY,WAAW,SAAS;QACrD;QAEA,IAAI,kBAAkB,OAAO,CAAC,MAAM,KAAK,GAAG;YAC1C,QAAQ,IAAI,CAAC;YACb;QACF;QAEA,MAAM,WAAW,IAAI,KAAK,kBAAkB,OAAO,EAAE;YACnD,MAAM;QACR;QAEA,IAAI;YACF,MAAM,UAAU,MAAM,IAAA,gKAAoB,EAAC;YAC3C,MAAM,MAAM,IAAI,eAAe,CAAC;YAChC,MAAM,MAAM,IAAI,OAAO,WAAW,GAAG,OAAO,CAAC,SAAS;YAEtD,MAAM,IAAI,SAAS,aAAa,CAAC;YACjC,EAAE,IAAI,GAAG;YACT,EAAE,QAAQ,GAAG,CAAC,YAAY,EAAE,IAAI,IAAI,CAAC;YACrC,SAAS,IAAI,CAAC,WAAW,CAAC;YAC1B,EAAE,KAAK;YACP,SAAS,IAAI,CAAC,WAAW,CAAC;YAC1B,WAAW,IAAM,IAAI,eAAe,CAAC,MAAM;QAC7C,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,kCAAkC;QAClD;IACF;IAEA,OAAO;QAAE;QAAgB;QAAe;IAAkB;AAC5D;uCAEe","debugId":null}},
    {"offset": {"line": 756, "column": 0}, "map": {"version":3,"sources":["file:///Users/christopheprat/Code/Side-projs/Hackathons/code-interview/src/app/voice/components/Transcript.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useRef, useState } from \"react\";\nimport ReactMarkdown from \"react-markdown\";\nimport { useTranscript } from \"@/app/voice/contexts/TranscriptContext\";\n\ninterface TranscriptProps {\n  userText: string;\n  setUserText: (val: string) => void;\n  onSendMessage: () => void;\n  canSend: boolean;\n  downloadRecording: () => void;\n}\n\nexport function Transcript({\n  userText,\n  setUserText,\n  onSendMessage,\n  canSend,\n  downloadRecording,\n}: TranscriptProps) {\n  const { transcriptItems, toggleTranscriptItemExpand } = useTranscript();\n  const transcriptRef = useRef<HTMLDivElement | null>(null);\n  const [previousItemsLength, setPreviousItemsLength] = useState(0);\n  const [justCopied, setJustCopied] = useState(false);\n  const inputRef = useRef<HTMLInputElement | null>(null);\n\n  useEffect(() => {\n    if (!transcriptRef.current) return;\n    if (transcriptItems.length !== previousItemsLength) {\n      transcriptRef.current.scrollTop = transcriptRef.current.scrollHeight;\n      setPreviousItemsLength(transcriptItems.length);\n    }\n  }, [transcriptItems, previousItemsLength]);\n\n  useEffect(() => {\n    if (canSend && inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, [canSend]);\n\n  const handleCopyTranscript = async () => {\n    if (!transcriptRef.current) return;\n    try {\n      await navigator.clipboard.writeText(transcriptRef.current.innerText);\n      setJustCopied(true);\n      setTimeout(() => setJustCopied(false), 1500);\n    } catch (error) {\n      console.error(\"Failed to copy transcript\", error);\n    }\n  };\n\n  return (\n    <div className=\"flex flex-col flex-1 bg-white min-h-0 rounded-xl\">\n      <div className=\"flex items-center justify-between px-6 py-3 sticky top-0 z-10 border-b bg-white rounded-t-xl\">\n        <span className=\"font-semibold\">Transcript</span>\n        <div className=\"flex gap-x-2\">\n          <button\n            onClick={handleCopyTranscript}\n            className=\"text-sm px-3 py-1 rounded-md bg-gray-200 hover:bg-gray-300\"\n          >\n            {justCopied ? \"Copied!\" : \"Copy\"}\n          </button>\n          <button\n            onClick={downloadRecording}\n            className=\"text-sm px-3 py-1 rounded-md bg-gray-200 hover:bg-gray-300\"\n          >\n            Download Audio\n          </button>\n        </div>\n      </div>\n\n      <div\n        ref={transcriptRef}\n        className=\"overflow-auto p-4 flex flex-col gap-y-4 h-full\"\n      >\n        {[...transcriptItems]\n          .sort((a, b) => a.createdAtMs - b.createdAtMs)\n          .map((item) => {\n            if (item.isHidden) return null;\n\n            if (item.type === \"MESSAGE\") {\n              const isUser = item.role === \"user\";\n              const containerClass = `flex flex-col ${\n                isUser ? \"items-end\" : \"items-start\"\n              }`;\n              const bubbleClass = `max-w-lg p-3 rounded-2xl ${\n                isUser\n                  ? \"bg-gray-900 text-white rounded-br-none\"\n                  : \"bg-gray-100 text-gray-900 rounded-bl-none\"\n              }`;\n\n              const content = item.title ?? \"\";\n              const isBracketed = content.startsWith(\"[\") && content.endsWith(\"]\");\n              const display = isBracketed ? content.slice(1, -1) : content;\n\n              return (\n                <div key={item.itemId} className={containerClass}>\n                  <div className={bubbleClass}>\n                    <div className=\"text-xs text-gray-400 font-mono mb-1\">\n                      {item.timestamp}\n                    </div>\n                    <div className={`whitespace-pre-wrap ${isBracketed ? \"italic text-gray-300\" : \"\"}`}>\n                      <ReactMarkdown>{display}</ReactMarkdown>\n                    </div>\n                  </div>\n                </div>\n              );\n            }\n\n            if (item.type === \"BREADCRUMB\") {\n              return (\n                <div\n                  key={item.itemId}\n                  className=\"flex flex-col text-sm text-gray-600\"\n                >\n                  <span className=\"text-xs font-mono text-gray-400\">\n                    {item.timestamp}\n                  </span>\n                  <div\n                    className={`whitespace-pre-wrap font-mono cursor-pointer ${\n                      item.data ? \"flex items-center\" : \"\"\n                    }`}\n                    onClick={() => item.data && toggleTranscriptItemExpand(item.itemId)}\n                  >\n                    {item.data && (\n                      <span\n                        className={`mr-2 transition-transform duration-200 ${\n                          item.expanded ? \"rotate-90\" : \"rotate-0\"\n                        }`}\n                      >\n                        ▶\n                      </span>\n                    )}\n                    {item.title}\n                  </div>\n                  {item.expanded && item.data && (\n                    <pre className=\"border-l-2 border-gray-200 ml-1 pl-2 text-xs text-gray-800 whitespace-pre-wrap\">\n                      {JSON.stringify(item.data, null, 2)}\n                    </pre>\n                  )}\n                </div>\n              );\n            }\n\n            return (\n              <div key={item.itemId} className=\"text-gray-500 text-xs\">\n                Unknown item type\n              </div>\n            );\n          })}\n      </div>\n\n      <div className=\"p-4 flex items-center gap-x-2 border-t border-gray-200\">\n        <input\n          ref={inputRef}\n          type=\"text\"\n          value={userText}\n          onChange={(e) => setUserText(e.target.value)}\n          onKeyDown={(e) => {\n            if (e.key === \"Enter\" && canSend) {\n              onSendMessage();\n            }\n          }}\n          placeholder=\"Type a message...\"\n          className=\"flex-1 px-4 py-2 border rounded-lg focus:outline-none\"\n        />\n        <button\n          onClick={onSendMessage}\n          disabled={!canSend || !userText.trim()}\n          className=\"bg-gray-900 text-white px-4 py-2 rounded-lg disabled:opacity-50\"\n        >\n          Send\n        </button>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1009, "column": 0}, "map": {"version":3,"sources":["file:///Users/christopheprat/Code/Side-projs/Hackathons/code-interview/src/app/voice/components/Events.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useRef, useState } from \"react\";\nimport { useEvent } from \"@/app/voice/contexts/EventContext\";\n\ninterface EventsProps {\n  isExpanded: boolean;\n}\n\nexport function Events({ isExpanded }: EventsProps) {\n  const { loggedEvents, toggleExpand } = useEvent();\n  const containerRef = useRef<HTMLDivElement | null>(null);\n  const [previousCount, setPreviousCount] = useState(0);\n\n  useEffect(() => {\n    if (!containerRef.current) return;\n    const hasNew = loggedEvents.length > previousCount;\n    if (isExpanded && hasNew) {\n      containerRef.current.scrollTop = containerRef.current.scrollHeight;\n    }\n    setPreviousCount(loggedEvents.length);\n  }, [loggedEvents, isExpanded, previousCount]);\n\n  const arrowForDirection = (direction: string) => {\n    switch (direction) {\n      case \"client\":\n        return { symbol: \"▲\", color: \"#7f5af0\" };\n      case \"server\":\n        return { symbol: \"▼\", color: \"#2cb67d\" };\n      default:\n        return { symbol: \"•\", color: \"#999\" };\n    }\n  };\n\n  return (\n    <div\n      ref={containerRef}\n      className={`${\n        isExpanded ? \"w-1/2 opacity-100\" : \"w-0 opacity-0\"\n      } transition-all duration-200 ease-in-out bg-white rounded-xl overflow-hidden`}\n    >\n      {isExpanded && (\n        <div className=\"flex flex-col h-full\">\n          <div className=\"px-6 py-3 border-b font-semibold\">Logs</div>\n          <div className=\"flex-1 overflow-auto\">\n            {loggedEvents.map((event) => {\n              const arrow = arrowForDirection(event.direction);\n              const isError =\n                event.eventName.toLowerCase().includes(\"error\") ||\n                Boolean(event.eventData?.response?.status_details?.error);\n\n              return (\n                <div\n                  key={event.id}\n                  className=\"border-b border-gray-200 px-6 py-2 text-sm font-mono\"\n                >\n                  <div\n                    className=\"flex items-center justify-between cursor-pointer\"\n                    onClick={() => toggleExpand(event.id)}\n                  >\n                    <div className=\"flex items-center gap-2 flex-1\">\n                      <span style={{ color: arrow.color }}>{arrow.symbol}</span>\n                      <span className={isError ? \"text-red-600\" : \"text-gray-800\"}>\n                        {event.eventName || \"(unnamed)\"}\n                      </span>\n                    </div>\n                    <span className=\"text-xs text-gray-500\">\n                      {event.timestamp}\n                    </span>\n                  </div>\n                  {event.expanded && (\n                    <pre className=\"text-xs text-gray-800 whitespace-pre-wrap break-words border-l-2 border-gray-200 mt-2 pl-2\">\n                      {JSON.stringify(event.eventData, null, 2)}\n                    </pre>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AASO,SAAS,OAAO,EAAE,UAAU,EAAe;IAChD,MAAM,EAAE,YAAY,EAAE,YAAY,EAAE,GAAG,IAAA,4JAAQ;IAC/C,MAAM,eAAe,IAAA,sXAAM,EAAwB;IACnD,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,wXAAQ,EAAC;IAEnD,IAAA,yXAAS,EAAC;QACR,IAAI,CAAC,aAAa,OAAO,EAAE;QAC3B,MAAM,SAAS,aAAa,MAAM,GAAG;QACrC,IAAI,cAAc,QAAQ;YACxB,aAAa,OAAO,CAAC,SAAS,GAAG,aAAa,OAAO,CAAC,YAAY;QACpE;QACA,iBAAiB,aAAa,MAAM;IACtC,GAAG;QAAC;QAAc;QAAY;KAAc;IAE5C,MAAM,oBAAoB,CAAC;QACzB,OAAQ;YACN,KAAK;gBACH,OAAO;oBAAE,QAAQ;oBAAK,OAAO;gBAAU;YACzC,KAAK;gBACH,OAAO;oBAAE,QAAQ;oBAAK,OAAO;gBAAU;YACzC;gBACE,OAAO;oBAAE,QAAQ;oBAAK,OAAO;gBAAO;QACxC;IACF;IAEA,qBACE,qZAAC;QACC,KAAK;QACL,WAAW,GACT,aAAa,sBAAsB,gBACpC,4EAA4E,CAAC;kBAE7E,4BACC,qZAAC;YAAI,WAAU;;8BACb,qZAAC;oBAAI,WAAU;8BAAmC;;;;;;8BAClD,qZAAC;oBAAI,WAAU;8BACZ,aAAa,GAAG,CAAC,CAAC;wBACjB,MAAM,QAAQ,kBAAkB,MAAM,SAAS;wBAC/C,MAAM,UACJ,MAAM,SAAS,CAAC,WAAW,GAAG,QAAQ,CAAC,YACvC,QAAQ,MAAM,SAAS,EAAE,UAAU,gBAAgB;wBAErD,qBACE,qZAAC;4BAEC,WAAU;;8CAEV,qZAAC;oCACC,WAAU;oCACV,SAAS,IAAM,aAAa,MAAM,EAAE;;sDAEpC,qZAAC;4CAAI,WAAU;;8DACb,qZAAC;oDAAK,OAAO;wDAAE,OAAO,MAAM,KAAK;oDAAC;8DAAI,MAAM,MAAM;;;;;;8DAClD,qZAAC;oDAAK,WAAW,UAAU,iBAAiB;8DACzC,MAAM,SAAS,IAAI;;;;;;;;;;;;sDAGxB,qZAAC;4CAAK,WAAU;sDACb,MAAM,SAAS;;;;;;;;;;;;gCAGnB,MAAM,QAAQ,kBACb,qZAAC;oCAAI,WAAU;8CACZ,KAAK,SAAS,CAAC,MAAM,SAAS,EAAE,MAAM;;;;;;;2BAnBtC,MAAM,EAAE;;;;;oBAwBnB;;;;;;;;;;;;;;;;;AAMZ","debugId":null}},
    {"offset": {"line": 1158, "column": 0}, "map": {"version":3,"sources":["file:///Users/christopheprat/Code/Side-projs/Hackathons/code-interview/src/app/voice/components/BottomToolbar.tsx"],"sourcesContent":["import React from \"react\";\nimport { SessionStatus } from \"@/app/voice/types\";\n\ninterface BottomToolbarProps {\n  sessionStatus: SessionStatus;\n  onToggleConnection: () => void;\n  isPTTActive: boolean;\n  setIsPTTActive: (value: boolean) => void;\n  isPTTUserSpeaking: boolean;\n  handleTalkButtonDown: () => void;\n  handleTalkButtonUp: () => void;\n  isEventsPaneExpanded: boolean;\n  setIsEventsPaneExpanded: (value: boolean) => void;\n  isAudioPlaybackEnabled: boolean;\n  setIsAudioPlaybackEnabled: (value: boolean) => void;\n}\n\nexport function BottomToolbar({\n  sessionStatus,\n  onToggleConnection,\n  isPTTActive,\n  setIsPTTActive,\n  isPTTUserSpeaking,\n  handleTalkButtonDown,\n  handleTalkButtonUp,\n  isEventsPaneExpanded,\n  setIsEventsPaneExpanded,\n  isAudioPlaybackEnabled,\n  setIsAudioPlaybackEnabled,\n}: BottomToolbarProps) {\n  const isConnected = sessionStatus === \"CONNECTED\";\n  const isConnecting = sessionStatus === \"CONNECTING\";\n\n  const connectionLabel = isConnected\n    ? \"Disconnect\"\n    : isConnecting\n      ? \"Connecting...\"\n      : \"Connect\";\n\n  return (\n    <div className=\"p-4 flex flex-row items-center justify-center gap-6 bg-white border-t\">\n      <button\n        onClick={onToggleConnection}\n        disabled={isConnecting}\n        className={`px-6 py-2 rounded-md text-white ${\n          isConnected ? \"bg-red-600 hover:bg-red-700\" : \"bg-black hover:bg-gray-900\"\n        } ${isConnecting ? \"cursor-not-allowed opacity-70\" : \"\"}`}\n      >\n        {connectionLabel}\n      </button>\n\n      <label className=\"flex items-center gap-2\">\n        <input\n          type=\"checkbox\"\n          checked={isPTTActive}\n          onChange={(e) => setIsPTTActive(e.target.checked)}\n          disabled={!isConnected}\n        />\n        Push to Talk\n      </label>\n      <button\n        onMouseDown={handleTalkButtonDown}\n        onMouseUp={handleTalkButtonUp}\n        onTouchStart={handleTalkButtonDown}\n        onTouchEnd={handleTalkButtonUp}\n        disabled={!isPTTActive}\n        className={`px-4 py-2 rounded-md ${\n          isPTTActive ? \"bg-gray-200 hover:bg-gray-300\" : \"bg-gray-100 text-gray-500\"\n        } ${isPTTUserSpeaking ? \"ring-2 ring-gray-400\" : \"\"}`}\n      >\n        Talk\n      </button>\n\n      <label className=\"flex items-center gap-2\">\n        <input\n          type=\"checkbox\"\n          checked={isAudioPlaybackEnabled}\n          onChange={(e) => setIsAudioPlaybackEnabled(e.target.checked)}\n          disabled={!isConnected}\n        />\n        Audio Playback\n      </label>\n\n      <label className=\"flex items-center gap-2\">\n        <input\n          type=\"checkbox\"\n          checked={isEventsPaneExpanded}\n          onChange={(e) => setIsEventsPaneExpanded(e.target.checked)}\n        />\n        Show Logs\n      </label>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;;AAiBO,SAAS,cAAc,EAC5B,aAAa,EACb,kBAAkB,EAClB,WAAW,EACX,cAAc,EACd,iBAAiB,EACjB,oBAAoB,EACpB,kBAAkB,EAClB,oBAAoB,EACpB,uBAAuB,EACvB,sBAAsB,EACtB,yBAAyB,EACN;IACnB,MAAM,cAAc,kBAAkB;IACtC,MAAM,eAAe,kBAAkB;IAEvC,MAAM,kBAAkB,cACpB,eACA,eACE,kBACA;IAEN,qBACE,qZAAC;QAAI,WAAU;;0BACb,qZAAC;gBACC,SAAS;gBACT,UAAU;gBACV,WAAW,CAAC,gCAAgC,EAC1C,cAAc,gCAAgC,6BAC/C,CAAC,EAAE,eAAe,kCAAkC,IAAI;0BAExD;;;;;;0BAGH,qZAAC;gBAAM,WAAU;;kCACf,qZAAC;wBACC,MAAK;wBACL,SAAS;wBACT,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,OAAO;wBAChD,UAAU,CAAC;;;;;;oBACX;;;;;;;0BAGJ,qZAAC;gBACC,aAAa;gBACb,WAAW;gBACX,cAAc;gBACd,YAAY;gBACZ,UAAU,CAAC;gBACX,WAAW,CAAC,qBAAqB,EAC/B,cAAc,kCAAkC,4BACjD,CAAC,EAAE,oBAAoB,yBAAyB,IAAI;0BACtD;;;;;;0BAID,qZAAC;gBAAM,WAAU;;kCACf,qZAAC;wBACC,MAAK;wBACL,SAAS;wBACT,UAAU,CAAC,IAAM,0BAA0B,EAAE,MAAM,CAAC,OAAO;wBAC3D,UAAU,CAAC;;;;;;oBACX;;;;;;;0BAIJ,qZAAC;gBAAM,WAAU;;kCACf,qZAAC;wBACC,MAAK;wBACL,SAAS;wBACT,UAAU,CAAC,IAAM,wBAAwB,EAAE,MAAM,CAAC,OAAO;;;;;;oBACzD;;;;;;;;;;;;;AAKV","debugId":null}},
    {"offset": {"line": 1264, "column": 0}, "map": {"version":3,"sources":["file:///Users/christopheprat/Code/Side-projs/Hackathons/code-interview/src/app/voice/App.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useMemo, useRef, useState, useCallback } from \"react\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { useTranscript } from \"@/app/voice/contexts/TranscriptContext\";\nimport { useEvent } from \"@/app/voice/contexts/EventContext\";\nimport { useRealtimeSession } from \"@/app/voice/hooks/useRealtimeSession\";\nimport useAudioDownload from \"@/app/voice/hooks/useAudioDownload\";\nimport { Transcript } from \"@/app/voice/components/Transcript\";\nimport { Events } from \"@/app/voice/components/Events\";\nimport { BottomToolbar } from \"@/app/voice/components/BottomToolbar\";\nimport { RealtimeAgent } from \"@openai/agents/realtime\";\n\nconst VOICE_AGENT = new RealtimeAgent({\n  name: \"voice_assistant\",\n  voice: \"verse\",\n  instructions:\n    \"You are a friendly interview coach. Speak conversationally, keep responses concise, and help candidates practice describing their experience.\",\n});\n\nexport function VoiceApp() {\n  const { addTranscriptMessage, addTranscriptBreadcrumb } = useTranscript();\n  const { logClientEvent, logServerEvent } = useEvent();\n\n  const audioElementRef = useRef<HTMLAudioElement | null>(null);\n\n  const sdkAudioElement = useMemo(() => {\n    if (typeof window === \"undefined\") return undefined;\n    const el = document.createElement(\"audio\");\n    el.autoplay = true;\n    el.style.display = \"none\";\n    document.body.appendChild(el);\n    return el;\n  }, []);\n\n  useEffect(() => {\n    if (sdkAudioElement && !audioElementRef.current) {\n      audioElementRef.current = sdkAudioElement;\n    }\n  }, [sdkAudioElement]);\n\n  const {\n    status: sessionStatus,\n    connect,\n    disconnect,\n    sendUserText,\n    sendEvent,\n    mute,\n    interrupt,\n  } = useRealtimeSession();\n\n  const [userText, setUserText] = useState(\"\");\n  const [isEventsPaneExpanded, setIsEventsPaneExpanded] = useState(true);\n  const [isPTTActive, setIsPTTActive] = useState(false);\n  const [isPTTUserSpeaking, setIsPTTUserSpeaking] = useState(false);\n  const [isAudioPlaybackEnabled, setIsAudioPlaybackEnabled] = useState(() => {\n    if (typeof window === \"undefined\") return true;\n    const stored = window.localStorage.getItem(\"voice-audio-playback\");\n    return stored ? stored === \"true\" : true;\n  });\n\n  const { startRecording, stopRecording, downloadRecording } = useAudioDownload();\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n    const storedPTT = window.localStorage.getItem(\"voice-ptt-active\");\n    if (storedPTT) setIsPTTActive(storedPTT === \"true\");\n    const storedLogs = window.localStorage.getItem(\"voice-logs-open\");\n    if (storedLogs) setIsEventsPaneExpanded(storedLogs === \"true\");\n  }, []);\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n    window.localStorage.setItem(\"voice-ptt-active\", String(isPTTActive));\n  }, [isPTTActive]);\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n    window.localStorage.setItem(\"voice-logs-open\", String(isEventsPaneExpanded));\n  }, [isEventsPaneExpanded]);\n\n  useEffect(() => {\n    if (typeof window === \"undefined\") return;\n    window.localStorage.setItem(\n      \"voice-audio-playback\",\n      String(isAudioPlaybackEnabled),\n    );\n  }, [isAudioPlaybackEnabled]);\n\n  useEffect(() => {\n    const el = audioElementRef.current;\n    if (!el) return;\n    if (isAudioPlaybackEnabled) {\n      el.muted = false;\n      el.play().catch((err) => {\n        console.warn(\"Autoplay blocked\", err);\n      });\n    } else {\n      el.muted = true;\n      el.pause();\n    }\n    mute(!isAudioPlaybackEnabled);\n  }, [isAudioPlaybackEnabled, mute]);\n\n  useEffect(() => {\n    if (sessionStatus === \"CONNECTED\" && audioElementRef.current?.srcObject) {\n      const remoteStream = audioElementRef.current.srcObject as MediaStream;\n      startRecording(remoteStream);\n      return () => {\n        stopRecording();\n      };\n    }\n    return undefined;\n  }, [sessionStatus, startRecording, stopRecording]);\n\n  const fetchEphemeralKey = useCallback(async () => {\n    logClientEvent({ url: \"/api/session\" }, \"fetch_session_token_request\");\n    const response = await fetch(\"/api/session\");\n    const data = await response.json();\n    logServerEvent(data, \"fetch_session_token_response\");\n\n    const key = data?.client_secret?.value;\n    if (!key) {\n      throw new Error(\"No ephemeral key returned\");\n    }\n    return key as string;\n  }, [logClientEvent, logServerEvent]);\n\n  const sendClientEvent = useCallback(\n    (eventObj: any, suffix = \"\") => {\n      try {\n        sendEvent(eventObj);\n        logClientEvent(eventObj, suffix);\n      } catch (err) {\n        console.error(\"Failed to send event\", err);\n      }\n    },\n    [sendEvent, logClientEvent],\n  );\n\n  const sendSimulatedUserMessage = useCallback(\n    (text: string) => {\n      const id = uuidv4().slice(0, 32);\n      addTranscriptMessage(id, \"user\", text, true);\n      sendClientEvent(\n        {\n          type: \"conversation.item.create\",\n          item: {\n            id,\n            type: \"message\",\n            role: \"user\",\n            content: [{ type: \"input_text\", text }],\n          },\n        },\n        \"(simulated user text message)\",\n      );\n      sendClientEvent({ type: \"response.create\" }, \"(auto greet)\");\n    },\n    [addTranscriptMessage, sendClientEvent],\n  );\n\n  const updateSession = useCallback(\n    (shouldPrompt = false) => {\n      const turnDetection = isPTTActive\n        ? null\n        : {\n            type: \"server_vad\",\n            threshold: 0.9,\n            prefix_padding_ms: 300,\n            silence_duration_ms: 500,\n            create_response: true,\n          };\n\n      sendClientEvent({\n        type: \"session.update\",\n        session: {\n          turn_detection: turnDetection,\n        },\n      });\n\n      if (shouldPrompt) {\n        sendSimulatedUserMessage(\"hi\");\n      }\n    },\n    [isPTTActive, sendClientEvent, sendSimulatedUserMessage],\n  );\n\n  const connectToRealtime = useCallback(async () => {\n    if (sessionStatus !== \"DISCONNECTED\") return;\n    try {\n      await connect({\n        getEphemeralKey: fetchEphemeralKey,\n        agent: VOICE_AGENT,\n        audioElement: sdkAudioElement,\n        extraContext: {\n          addTranscriptBreadcrumb,\n        },\n      });\n      updateSession(true);\n    } catch (err) {\n      console.error(\"Error connecting to realtime session\", err);\n    }\n  }, [sessionStatus, connect, fetchEphemeralKey, sdkAudioElement, addTranscriptBreadcrumb, updateSession]);\n\n  const disconnectFromRealtime = useCallback(() => {\n    disconnect();\n    setIsPTTUserSpeaking(false);\n  }, [disconnect]);\n\n  useEffect(() => {\n    if (sessionStatus === \"CONNECTED\") {\n      updateSession(false);\n    }\n  }, [sessionStatus, updateSession, isPTTActive]);\n\n  const handleSendTextMessage = useCallback(() => {\n    if (!userText.trim()) return;\n    interrupt();\n    try {\n      sendUserText(userText.trim());\n      logClientEvent({ type: \"user_message\", text: userText.trim() });\n    } catch (err) {\n      console.error(\"Failed to send user text\", err);\n    }\n    setUserText(\"\");\n  }, [userText, interrupt, sendUserText, logClientEvent]);\n\n  const handleTalkButtonDown = useCallback(() => {\n    if (sessionStatus !== \"CONNECTED\") return;\n    interrupt();\n    setIsPTTUserSpeaking(true);\n    sendClientEvent({ type: \"input_audio_buffer.clear\" }, \"clear PTT buffer\");\n  }, [sessionStatus, interrupt, sendClientEvent]);\n\n  const handleTalkButtonUp = useCallback(() => {\n    if (sessionStatus !== \"CONNECTED\" || !isPTTUserSpeaking) return;\n    setIsPTTUserSpeaking(false);\n    sendClientEvent({ type: \"input_audio_buffer.commit\" }, \"commit PTT\");\n    sendClientEvent({ type: \"response.create\" }, \"trigger response PTT\");\n  }, [sessionStatus, isPTTUserSpeaking, sendClientEvent]);\n\n  const handleToggleConnection = useCallback(() => {\n    if (sessionStatus === \"CONNECTED\" || sessionStatus === \"CONNECTING\") {\n      disconnectFromRealtime();\n    } else {\n      connectToRealtime();\n    }\n  }, [sessionStatus, disconnectFromRealtime, connectToRealtime]);\n\n  return (\n    <div className=\"flex flex-col h-screen bg-gray-100 text-gray-800\">\n      <div className=\"px-5 py-4 text-lg font-semibold border-b bg-white flex items-center justify-between\">\n        <span>Realtime Voice Agent</span>\n        <span className=\"text-sm text-gray-500\">\n          Status: {sessionStatus}\n        </span>\n      </div>\n      <div className=\"flex flex-1 gap-2 px-2 py-2 overflow-hidden\">\n        <Transcript\n          userText={userText}\n          setUserText={setUserText}\n          onSendMessage={handleSendTextMessage}\n          canSend={sessionStatus === \"CONNECTED\"}\n          downloadRecording={downloadRecording}\n        />\n        <Events isExpanded={isEventsPaneExpanded} />\n      </div>\n      <BottomToolbar\n        sessionStatus={sessionStatus}\n        onToggleConnection={handleToggleConnection}\n        isPTTActive={isPTTActive}\n        setIsPTTActive={setIsPTTActive}\n        isPTTUserSpeaking={isPTTUserSpeaking}\n        handleTalkButtonDown={handleTalkButtonDown}\n        handleTalkButtonUp={handleTalkButtonUp}\n        isEventsPaneExpanded={isEventsPaneExpanded}\n        setIsEventsPaneExpanded={setIsEventsPaneExpanded}\n        isAudioPlaybackEnabled={isAudioPlaybackEnabled}\n        setIsAudioPlaybackEnabled={setIsAudioPlaybackEnabled}\n      />\n    </div>\n  );\n}\n\nexport default VoiceApp;\n"],"names":[],"mappings":"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","debugId":null}}]
}
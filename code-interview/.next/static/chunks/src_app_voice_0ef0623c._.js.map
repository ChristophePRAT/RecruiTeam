{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/christopheprat/Code/Side-projs/Hackathons/code-interview/src/app/voice/contexts/TranscriptContext.tsx"],"sourcesContent":["\"use client\";\n\nimport React, {\n  createContext,\n  useContext,\n  useState,\n  PropsWithChildren,\n} from \"react\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { TranscriptItem } from \"@/app/voice/types\";\n\ntype TranscriptContextValue = {\n  transcriptItems: TranscriptItem[];\n  addTranscriptMessage: (\n    itemId: string,\n    role: \"user\" | \"assistant\",\n    text: string,\n    isHidden?: boolean,\n  ) => void;\n  updateTranscriptMessage: (itemId: string, text: string, isDelta: boolean) => void;\n  addTranscriptBreadcrumb: (title: string, data?: Record<string, unknown>) => void;\n  toggleTranscriptItemExpand: (itemId: string) => void;\n};\n\nconst TranscriptContext = createContext<TranscriptContextValue | undefined>(\n  undefined,\n);\n\nexport function TranscriptProvider({ children }: PropsWithChildren) {\n  const [transcriptItems, setTranscriptItems] = useState<TranscriptItem[]>([]);\n\n  function newTimestampPretty(): string {\n    const now = new Date();\n    const time = now.toLocaleTimeString([], {\n      hour12: false,\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n      second: \"2-digit\",\n    });\n    const ms = now.getMilliseconds().toString().padStart(3, \"0\");\n    return `${time}.${ms}`;\n  }\n\n  const addTranscriptMessage: TranscriptContextValue[\"addTranscriptMessage\"] = (\n    itemId,\n    role,\n    text = \"\",\n    isHidden = false,\n  ) => {\n    setTranscriptItems((prev) => {\n      if (prev.some((item) => item.itemId === itemId)) {\n        return prev;\n      }\n\n      const newItem: TranscriptItem = {\n        itemId,\n        type: \"MESSAGE\",\n        role,\n        title: text,\n        data: undefined,\n        expanded: false,\n        timestamp: newTimestampPretty(),\n        createdAtMs: Date.now(),\n        status: \"IN_PROGRESS\",\n        isHidden,\n      };\n\n      return [...prev, newItem];\n    });\n  };\n\n  const updateTranscriptMessage: TranscriptContextValue[\"updateTranscriptMessage\"] = (\n    itemId,\n    newText,\n    append,\n  ) => {\n    setTranscriptItems((prev) =>\n      prev.map((item) =>\n        item.itemId === itemId && item.type === \"MESSAGE\"\n          ? {\n              ...item,\n              title: append ? `${item.title ?? \"\"}${newText}` : newText,\n              status: \"DONE\",\n            }\n          : item,\n      ),\n    );\n  };\n\n  const addTranscriptBreadcrumb: TranscriptContextValue[\"addTranscriptBreadcrumb\"] = (\n    title,\n    data,\n  ) => {\n    setTranscriptItems((prev) => [\n      ...prev,\n      {\n        itemId: `breadcrumb-${uuidv4()}`,\n        type: \"BREADCRUMB\",\n        title,\n        data,\n        expanded: false,\n        timestamp: newTimestampPretty(),\n        createdAtMs: Date.now(),\n        status: \"DONE\",\n        isHidden: false,\n      },\n    ]);\n  };\n\n  const toggleTranscriptItemExpand: TranscriptContextValue[\"toggleTranscriptItemExpand\"] = (\n    itemId,\n  ) => {\n    setTranscriptItems((prev) =>\n      prev.map((item) =>\n        item.itemId === itemId\n          ? { ...item, expanded: !item.expanded }\n          : item,\n      ),\n    );\n  };\n\n  return (\n    <TranscriptContext.Provider\n      value={{\n        transcriptItems,\n        addTranscriptMessage,\n        updateTranscriptMessage,\n        addTranscriptBreadcrumb,\n        toggleTranscriptItemExpand,\n      }}\n    >\n      {children}\n    </TranscriptContext.Provider>\n  );\n}\n\nexport function useTranscript() {\n  const ctx = useContext(TranscriptContext);\n  if (!ctx) {\n    throw new Error(\"useTranscript must be used within a TranscriptProvider\");\n  }\n  return ctx;\n}\n"],"names":[],"mappings":";;;;;;;AAEA;AAMA;;;AARA;;;AAwBA,MAAM,kCAAoB,IAAA,qVAAa,EACrC;AAGK,SAAS,mBAAmB,KAA+B;QAA/B,EAAE,QAAQ,EAAqB,GAA/B;;IACjC,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,gVAAQ,EAAmB,EAAE;IAE3E,SAAS;QACP,MAAM,MAAM,IAAI;QAChB,MAAM,OAAO,IAAI,kBAAkB,CAAC,EAAE,EAAE;YACtC,QAAQ;YACR,MAAM;YACN,QAAQ;YACR,QAAQ;QACV;QACA,MAAM,KAAK,IAAI,eAAe,GAAG,QAAQ,GAAG,QAAQ,CAAC,GAAG;QACxD,OAAO,AAAC,GAAU,OAAR,MAAK,KAAM,OAAH;IACpB;IAEA,MAAM,uBAAuE,SAC3E,QACA;YACA,wEAAO,IACP,4EAAW;QAEX,mBAAmB,CAAC;YAClB,IAAI,KAAK,IAAI,CAAC,CAAC,OAAS,KAAK,MAAM,KAAK,SAAS;gBAC/C,OAAO;YACT;YAEA,MAAM,UAA0B;gBAC9B;gBACA,MAAM;gBACN;gBACA,OAAO;gBACP,MAAM;gBACN,UAAU;gBACV,WAAW;gBACX,aAAa,KAAK,GAAG;gBACrB,QAAQ;gBACR;YACF;YAEA,OAAO;mBAAI;gBAAM;aAAQ;QAC3B;IACF;IAEA,MAAM,0BAA6E,CACjF,QACA,SACA;QAEA,mBAAmB,CAAC,OAClB,KAAK,GAAG,CAAC,CAAC;oBAIiB;uBAHzB,KAAK,MAAM,KAAK,UAAU,KAAK,IAAI,KAAK,YACpC;oBACE,GAAG,IAAI;oBACP,OAAO,SAAS,AAAC,GAAqB,OAAnB,CAAA,cAAA,KAAK,KAAK,cAAV,yBAAA,cAAc,IAAa,OAAR,WAAY;oBAClD,QAAQ;gBACV,IACA;;IAGV;IAEA,MAAM,0BAA6E,CACjF,OACA;QAEA,mBAAmB,CAAC,OAAS;mBACxB;gBACH;oBACE,QAAQ,AAAC,cAAsB,OAAT,IAAA,+OAAM;oBAC5B,MAAM;oBACN;oBACA;oBACA,UAAU;oBACV,WAAW;oBACX,aAAa,KAAK,GAAG;oBACrB,QAAQ;oBACR,UAAU;gBACZ;aACD;IACH;IAEA,MAAM,6BAAmF,CACvF;QAEA,mBAAmB,CAAC,OAClB,KAAK,GAAG,CAAC,CAAC,OACR,KAAK,MAAM,KAAK,SACZ;oBAAE,GAAG,IAAI;oBAAE,UAAU,CAAC,KAAK,QAAQ;gBAAC,IACpC;IAGV;IAEA,qBACE,oWAAC,kBAAkB,QAAQ;QACzB,OAAO;YACL;YACA;YACA;YACA;YACA;QACF;kBAEC;;;;;;AAGP;GA1GgB;KAAA;AA4GT,SAAS;;IACd,MAAM,MAAM,IAAA,kVAAU,EAAC;IACvB,IAAI,CAAC,KAAK;QACR,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;IANgB","debugId":null}},
    {"offset": {"line": 125, "column": 0}, "map": {"version":3,"sources":["file:///Users/christopheprat/Code/Side-projs/Hackathons/code-interview/src/app/voice/contexts/EventContext.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { createContext, useContext, useState, PropsWithChildren } from \"react\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { LoggedEvent } from \"@/app/voice/types\";\n\ntype EventContextValue = {\n  loggedEvents: LoggedEvent[];\n  logClientEvent: (eventObj: Record<string, unknown>, eventNameSuffix?: string) => void;\n  logServerEvent: (eventObj: Record<string, unknown>, eventNameSuffix?: string) => void;\n  toggleExpand: (id: string) => void;\n};\n\nconst EventContext = createContext<EventContextValue | undefined>(undefined);\n\nexport function EventProvider({ children }: PropsWithChildren) {\n  const [loggedEvents, setLoggedEvents] = useState<LoggedEvent[]>([]);\n\n  function addLoggedEvent(direction: \"client\" | \"server\", name: string, data: Record<string, unknown>) {\n    const id = data.event_id || uuidv4();\n    setLoggedEvents((prev) => [\n      ...prev,\n      {\n        id,\n        direction,\n        eventName: name,\n        eventData: data,\n        timestamp: new Date().toLocaleTimeString(),\n        expanded: false,\n      },\n    ]);\n  }\n\n  const logClientEvent: EventContextValue[\"logClientEvent\"] = (eventObj, suffix = \"\") => {\n    const name = `${eventObj.type || \"\"} ${suffix}`.trim();\n    addLoggedEvent(\"client\", name, eventObj);\n  };\n\n  const logServerEvent: EventContextValue[\"logServerEvent\"] = (eventObj, suffix = \"\") => {\n    const name = `${eventObj.type || \"\"} ${suffix}`.trim();\n    addLoggedEvent(\"server\", name, eventObj);\n  };\n\n  const toggleExpand: EventContextValue[\"toggleExpand\"] = (id) => {\n    setLoggedEvents((prev) =>\n      prev.map((item) =>\n        item.id === id ? { ...item, expanded: !item.expanded } : item,\n      ),\n    );\n  };\n\n  return (\n    <EventContext.Provider value={{ loggedEvents, logClientEvent, logServerEvent, toggleExpand }}>\n      {children}\n    </EventContext.Provider>\n  );\n}\n\nexport function useEvent() {\n  const ctx = useContext(EventContext);\n  if (!ctx) {\n    throw new Error(\"useEvent must be used within an EventProvider\");\n  }\n  return ctx;\n}\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;;;AAHA;;;AAaA,MAAM,6BAAe,IAAA,qVAAa,EAAgC;AAE3D,SAAS,cAAc,KAA+B;QAA/B,EAAE,QAAQ,EAAqB,GAA/B;;IAC5B,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,gVAAQ,EAAgB,EAAE;IAElE,SAAS,eAAe,SAA8B,EAAE,IAAY,EAAE,IAA6B;QACjG,MAAM,KAAK,KAAK,QAAQ,IAAI,IAAA,+OAAM;QAClC,gBAAgB,CAAC,OAAS;mBACrB;gBACH;oBACE;oBACA;oBACA,WAAW;oBACX,WAAW;oBACX,WAAW,IAAI,OAAO,kBAAkB;oBACxC,UAAU;gBACZ;aACD;IACH;IAEA,MAAM,iBAAsD,SAAC;YAAU,0EAAS;QAC9E,MAAM,OAAO,AAAC,GAAyB,OAAvB,SAAS,IAAI,IAAI,IAAG,KAAU,OAAP,QAAS,IAAI;QACpD,eAAe,UAAU,MAAM;IACjC;IAEA,MAAM,iBAAsD,SAAC;YAAU,0EAAS;QAC9E,MAAM,OAAO,AAAC,GAAyB,OAAvB,SAAS,IAAI,IAAI,IAAG,KAAU,OAAP,QAAS,IAAI;QACpD,eAAe,UAAU,MAAM;IACjC;IAEA,MAAM,eAAkD,CAAC;QACvD,gBAAgB,CAAC,OACf,KAAK,GAAG,CAAC,CAAC,OACR,KAAK,EAAE,KAAK,KAAK;oBAAE,GAAG,IAAI;oBAAE,UAAU,CAAC,KAAK,QAAQ;gBAAC,IAAI;IAG/D;IAEA,qBACE,oWAAC,aAAa,QAAQ;QAAC,OAAO;YAAE;YAAc;YAAgB;YAAgB;QAAa;kBACxF;;;;;;AAGP;GAzCgB;KAAA;AA2CT,SAAS;;IACd,MAAM,MAAM,IAAA,kVAAU,EAAC;IACvB,IAAI,CAAC,KAAK;QACR,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;IANgB","debugId":null}},
    {"offset": {"line": 208, "column": 0}, "map": {"version":3,"sources":["file:///Users/christopheprat/Code/Side-projs/Hackathons/code-interview/src/app/voice/lib/codecUtils.ts"],"sourcesContent":["type SenderWithCapabilities = typeof RTCRtpSender & {\n  getCapabilities?: (kind: \"audio\") => RTCRtpCapabilities | undefined;\n};\n\nexport function audioFormatForCodec(codec: string): \"pcm16\" | \"g711_ulaw\" | \"g711_alaw\" {\n  const lower = codec.toLowerCase();\n  if (lower === \"pcmu\") return \"g711_ulaw\";\n  if (lower === \"pcma\") return \"g711_alaw\";\n  return \"pcm16\";\n}\n\nexport function applyCodecPreferences(\n  pc: RTCPeerConnection,\n  codec: string,\n): void {\n  try {\n    const sender = RTCRtpSender as SenderWithCapabilities;\n    const capabilities = sender.getCapabilities?.(\"audio\");\n    if (!capabilities) return;\n\n    const target = capabilities.codecs.find(\n      (c) => c.mimeType.toLowerCase() === `audio/${codec.toLowerCase()}`,\n    );\n    if (!target) return;\n\n    pc\n      .getTransceivers()\n      .filter((transceiver) => transceiver.sender?.track?.kind === \"audio\")\n      .forEach((transceiver) => transceiver.setCodecPreferences([target]));\n  } catch (err) {\n    console.error(\"Failed to apply codec preferences\", err);\n  }\n}\n"],"names":[],"mappings":";;;;;;AAIO,SAAS,oBAAoB,KAAa;IAC/C,MAAM,QAAQ,MAAM,WAAW;IAC/B,IAAI,UAAU,QAAQ,OAAO;IAC7B,IAAI,UAAU,QAAQ,OAAO;IAC7B,OAAO;AACT;AAEO,SAAS,sBACd,EAAqB,EACrB,KAAa;IAEb,IAAI;YAEmB;QADrB,MAAM,SAAS;QACf,MAAM,gBAAe,0BAAA,OAAO,eAAe,cAAtB,8CAAA,6BAAA,QAAyB;QAC9C,IAAI,CAAC,cAAc;QAEnB,MAAM,SAAS,aAAa,MAAM,CAAC,IAAI,CACrC,CAAC,IAAM,EAAE,QAAQ,CAAC,WAAW,OAAO,AAAC,SAA4B,OAApB,MAAM,WAAW;QAEhE,IAAI,CAAC,QAAQ;QAEb,GACG,eAAe,GACf,MAAM,CAAC,CAAC;gBAAgB,2BAAA;mBAAA,EAAA,sBAAA,YAAY,MAAM,cAAlB,2CAAA,4BAAA,oBAAoB,KAAK,cAAzB,gDAAA,0BAA2B,IAAI,MAAK;WAC5D,OAAO,CAAC,CAAC,cAAgB,YAAY,mBAAmB,CAAC;gBAAC;aAAO;IACtE,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,qCAAqC;IACrD;AACF","debugId":null}},
    {"offset": {"line": 245, "column": 0}, "map": {"version":3,"sources":["file:///Users/christopheprat/Code/Side-projs/Hackathons/code-interview/src/app/voice/hooks/useHandleSessionHistory.ts"],"sourcesContent":["\"use client\";\n\nimport { useRef } from \"react\";\nimport { useTranscript } from \"@/app/voice/contexts/TranscriptContext\";\nimport { useEvent } from \"@/app/voice/contexts/EventContext\";\n\nexport interface HistoryContentItem {\n  type?: string;\n  text?: string;\n  transcript?: string;\n}\n\nexport interface HistoryMessage {\n  type?: string;\n  itemId?: string;\n  role?: \"user\" | \"assistant\";\n  content?: HistoryContentItem[];\n}\n\nexport interface TranscriptionEvent {\n  item_id?: string;\n  delta?: string;\n  transcript?: string;\n}\n\nexport interface TransportEvent {\n  type?: string;\n  [key: string]: unknown;\n}\n\nexport function useHandleSessionHistory() {\n  const {\n    addTranscriptBreadcrumb,\n    addTranscriptMessage,\n    updateTranscriptMessage,\n  } = useTranscript();\n  const { logServerEvent } = useEvent();\n\n  const extractMessageText = (content: HistoryContentItem[] = []): string => {\n    return content\n      .map((item) => {\n        if (!item) return \"\";\n        if (item.type === \"input_text\" || item.type === \"output_text\") {\n          return item.text ?? \"\";\n        }\n        if (item.type === \"audio\") {\n          return item.transcript ?? \"\";\n        }\n        return \"\";\n      })\n      .filter(Boolean)\n      .join(\"\\n\");\n  };\n\n  function handleHistoryAdded(item: HistoryMessage) {\n    if (!item || item.type !== \"message\") return;\n    const { itemId, role, content = [] } = item;\n    if (!itemId || !role) return;\n\n    const text = extractMessageText(content) || (role === \"user\" ? \"[Listening...]\" : \"\");\n    addTranscriptMessage(itemId, role, text);\n  }\n\n  function handleHistoryUpdated(items: HistoryMessage[]) {\n    items.forEach((item) => {\n      if (!item || item.type !== \"message\") return;\n      const { itemId, content = [] } = item;\n      if (!itemId) return;\n\n      const text = extractMessageText(content);\n      if (text) {\n        updateTranscriptMessage(itemId, text, false);\n      }\n    });\n  }\n\n  function handleTranscriptionDelta(event: TranscriptionEvent) {\n    const itemId = event.item_id;\n    const deltaText = event.delta || \"\";\n    if (itemId && deltaText) {\n      updateTranscriptMessage(itemId, deltaText, true);\n    }\n  }\n\n  function handleTranscriptionCompleted(event: TranscriptionEvent) {\n    const itemId = event.item_id;\n    const finalTranscript = event.transcript || \"\";\n    if (itemId) {\n      updateTranscriptMessage(itemId, finalTranscript || \"[inaudible]\", false);\n    }\n  }\n\n  function handleTransportEvent(event: TransportEvent) {\n    logServerEvent(event);\n  }\n\n  const handlersRef = useRef({\n    handleHistoryAdded,\n    handleHistoryUpdated,\n    handleTranscriptionDelta,\n    handleTranscriptionCompleted,\n    handleTransportEvent,\n    addTranscriptBreadcrumb,\n  });\n\n  return handlersRef;\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;;AAJA;;;;AA8BO,SAAS;;IACd,MAAM,EACJ,uBAAuB,EACvB,oBAAoB,EACpB,uBAAuB,EACxB,GAAG,IAAA,yKAAa;IACjB,MAAM,EAAE,cAAc,EAAE,GAAG,IAAA,+JAAQ;IAEnC,MAAM,qBAAqB;YAAC,2EAAgC,EAAE;QAC5D,OAAO,QACJ,GAAG,CAAC,CAAC;YACJ,IAAI,CAAC,MAAM,OAAO;YAClB,IAAI,KAAK,IAAI,KAAK,gBAAgB,KAAK,IAAI,KAAK,eAAe;oBACtD;gBAAP,OAAO,CAAA,aAAA,KAAK,IAAI,cAAT,wBAAA,aAAa;YACtB;YACA,IAAI,KAAK,IAAI,KAAK,SAAS;oBAClB;gBAAP,OAAO,CAAA,mBAAA,KAAK,UAAU,cAAf,8BAAA,mBAAmB;YAC5B;YACA,OAAO;QACT,GACC,MAAM,CAAC,SACP,IAAI,CAAC;IACV;IAEA,SAAS,mBAAmB,IAAoB;QAC9C,IAAI,CAAC,QAAQ,KAAK,IAAI,KAAK,WAAW;QACtC,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,UAAU,EAAE,EAAE,GAAG;QACvC,IAAI,CAAC,UAAU,CAAC,MAAM;QAEtB,MAAM,OAAO,mBAAmB,YAAY,CAAC,SAAS,SAAS,mBAAmB,EAAE;QACpF,qBAAqB,QAAQ,MAAM;IACrC;IAEA,SAAS,qBAAqB,KAAuB;QACnD,MAAM,OAAO,CAAC,CAAC;YACb,IAAI,CAAC,QAAQ,KAAK,IAAI,KAAK,WAAW;YACtC,MAAM,EAAE,MAAM,EAAE,UAAU,EAAE,EAAE,GAAG;YACjC,IAAI,CAAC,QAAQ;YAEb,MAAM,OAAO,mBAAmB;YAChC,IAAI,MAAM;gBACR,wBAAwB,QAAQ,MAAM;YACxC;QACF;IACF;IAEA,SAAS,yBAAyB,KAAyB;QACzD,MAAM,SAAS,MAAM,OAAO;QAC5B,MAAM,YAAY,MAAM,KAAK,IAAI;QACjC,IAAI,UAAU,WAAW;YACvB,wBAAwB,QAAQ,WAAW;QAC7C;IACF;IAEA,SAAS,6BAA6B,KAAyB;QAC7D,MAAM,SAAS,MAAM,OAAO;QAC5B,MAAM,kBAAkB,MAAM,UAAU,IAAI;QAC5C,IAAI,QAAQ;YACV,wBAAwB,QAAQ,mBAAmB,eAAe;QACpE;IACF;IAEA,SAAS,qBAAqB,KAAqB;QACjD,eAAe;IACjB;IAEA,MAAM,cAAc,IAAA,8UAAM,EAAC;QACzB;QACA;QACA;QACA;QACA;QACA;IACF;IAEA,OAAO;AACT;GA5EgB;;QAKV,yKAAa;QACU,+JAAQ","debugId":null}},
    {"offset": {"line": 334, "column": 0}, "map": {"version":3,"sources":["file:///Users/christopheprat/Code/Side-projs/Hackathons/code-interview/src/app/voice/hooks/useRealtimeSession.ts"],"sourcesContent":["import { useCallback, useRef, useState } from \"react\";\nimport {\n    RealtimeSession,\n    RealtimeAgent,\n    OpenAIRealtimeWebRTC,\n} from \"@openai/agents/realtime\";\n\nimport {\n    audioFormatForCodec,\n    applyCodecPreferences,\n} from \"@/app/voice/lib/codecUtils\";\nimport { useEvent } from \"@/app/voice/contexts/EventContext\";\nimport {\n    useHandleSessionHistory,\n    HistoryMessage,\n    TransportEvent,\n} from \"@/app/voice/hooks/useHandleSessionHistory\";\nimport { SessionStatus } from \"@/app/voice/types\";\n\nexport interface RealtimeSessionCallbacks {\n    onConnectionChange?: (status: SessionStatus) => void;\n}\n\ninterface ConnectOptions {\n    getEphemeralKey: () => Promise<string>;\n    agent: RealtimeAgent;\n    audioElement?: HTMLAudioElement;\n    extraContext?: Record<string, unknown>;\n    outputGuardrails?: unknown[];\n}\n\nexport function useRealtimeSession(callbacks: RealtimeSessionCallbacks = {}) {\n    const sessionRef = useRef<RealtimeSession | null>(null);\n    const [status, setStatus] = useState<SessionStatus>(\"DISCONNECTED\");\n    const { logClientEvent, logServerEvent } = useEvent();\n    const historyHandlersRef = useHandleSessionHistory();\n    const realtimeModel =\n        process.env.NEXT_PUBLIC_REALTIME_MODEL ??\n        \"gpt-4o-realtime-preview-2025-06-03\";\n\n    const updateStatus = useCallback(\n        (next: SessionStatus) => {\n            setStatus(next);\n            callbacks.onConnectionChange?.(next);\n            logClientEvent({ type: \"status_change\", value: next });\n        },\n        [callbacks, logClientEvent],\n    );\n\n    const connect = useCallback(\n        async ({\n            getEphemeralKey,\n            agent,\n            audioElement,\n            extraContext,\n            outputGuardrails,\n        }: ConnectOptions) => {\n            if (sessionRef.current) return;\n\n            updateStatus(\"CONNECTING\");\n            const key = await getEphemeralKey();\n\n            const codec =\n                typeof window !== \"undefined\"\n                    ? (new URLSearchParams(window.location.search).get(\n                          \"codec\",\n                      ) ?? \"opus\")\n                    : \"opus\";\n            const codecParam = codec.toLowerCase();\n            const audioFormat = audioFormatForCodec(codecParam);\n\n            const session = new RealtimeSession(agent, {\n                transport: new OpenAIRealtimeWebRTC({\n                    audioElement,\n                    changePeerConnection: async (pc: RTCPeerConnection) => {\n                        applyCodecPreferences(pc, codecParam);\n                        return pc;\n                    },\n                }),\n                model: realtimeModel,\n                config: {\n                    inputAudioFormat: audioFormat,\n                    outputAudioFormat: audioFormat,\n                    inputAudioTranscription: {\n                        model: \"gpt-4o-mini-transcribe\",\n                    },\n                },\n                outputGuardrails: outputGuardrails ?? [],\n                context: extraContext ?? {},\n            });\n\n            session.on(\"connected\", () =>\n                logServerEvent({ type: \"connected\" }),\n            );\n            session.on(\"disconnected\", () =>\n                logServerEvent({ type: \"disconnected\" }),\n            );\n            session.on(\"error\", (err) => {\n                logServerEvent({ type: \"error\", error: err });\n            });\n\n            session.on(\"history_added\", (item: HistoryMessage) => {\n                historyHandlersRef.current.handleHistoryAdded(item);\n            });\n            session.on(\"history_updated\", (items: HistoryMessage[]) => {\n                historyHandlersRef.current.handleHistoryUpdated(items);\n            });\n            session.on(\"agent_output_created\", (event: TransportEvent) => {\n                historyHandlersRef.current.handleTransportEvent(event);\n            });\n            session.on(\"transport_event\", (event: TransportEvent) => {\n                switch (event.type) {\n                    case \"conversation.item.input_audio_transcription.delta\":\n                        historyHandlersRef.current.handleTranscriptionDelta(\n                            event,\n                        );\n                        break;\n                    case \"conversation.item.input_audio_transcription.completed\":\n                    case \"response.audio_transcript.done\":\n                        historyHandlersRef.current.handleTranscriptionCompleted(\n                            event,\n                        );\n                        break;\n                    default:\n                        historyHandlersRef.current.handleTransportEvent(event);\n                }\n            });\n\n            sessionRef.current = session;\n\n            try {\n                await session.connect({\n                    apiKey: key,\n                });\n                updateStatus(\"CONNECTED\");\n            } catch (error) {\n                logServerEvent({\n                    type: \"connection_error\",\n                    message:\n                        error instanceof Error ? error.message : String(error),\n                });\n                session.close();\n                sessionRef.current = null;\n                updateStatus(\"DISCONNECTED\");\n                throw error;\n            }\n        },\n        [updateStatus, historyHandlersRef, logServerEvent, realtimeModel],\n    );\n\n    const disconnect = useCallback(() => {\n        sessionRef.current?.close();\n        sessionRef.current = null;\n        updateStatus(\"DISCONNECTED\");\n    }, [updateStatus]);\n\n    const interrupt = useCallback(() => {\n        sessionRef.current?.interrupt();\n    }, []);\n\n    const sendUserText = useCallback((text: string) => {\n        if (!sessionRef.current) throw new Error(\"Session not connected\");\n        sessionRef.current.sendMessage(text);\n    }, []);\n\n    const sendEvent = useCallback((event: Record<string, unknown>) => {\n        sessionRef.current?.transport.sendEvent(event);\n    }, []);\n\n    const mute = useCallback((shouldMute: boolean) => {\n        sessionRef.current?.mute(shouldMute);\n    }, []);\n\n    return {\n        status,\n        connect,\n        disconnect,\n        sendUserText,\n        sendEvent,\n        mute,\n        interrupt,\n    } as const;\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 533, "column": 0}, "map": {"version":3,"sources":["file:///Users/christopheprat/Code/Side-projs/Hackathons/code-interview/src/app/voice/lib/audioUtils.ts"],"sourcesContent":["export function writeString(view: DataView, offset: number, str: string) {\n  for (let i = 0; i < str.length; i++) {\n    view.setUint8(offset + i, str.charCodeAt(i));\n  }\n}\n\nexport function floatTo16BitPCM(output: DataView, offset: number, input: Float32Array) {\n  for (let i = 0; i < input.length; i++, offset += 2) {\n    const s = Math.max(-1, Math.min(1, input[i]));\n    output.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7fff, true);\n  }\n}\n\nexport function encodeWAV(samples: Float32Array, sampleRate: number): ArrayBuffer {\n  const buffer = new ArrayBuffer(44 + samples.length * 2);\n  const view = new DataView(buffer);\n\n  writeString(view, 0, \"RIFF\");\n  view.setUint32(4, 36 + samples.length * 2, true);\n  writeString(view, 8, \"WAVE\");\n  writeString(view, 12, \"fmt \");\n  view.setUint32(16, 16, true);\n  view.setUint16(20, 1, true);\n  view.setUint16(22, 1, true);\n  view.setUint32(24, sampleRate, true);\n  view.setUint32(28, sampleRate * 2, true);\n  view.setUint16(32, 2, true);\n  view.setUint16(34, 16, true);\n  writeString(view, 36, \"data\");\n  view.setUint32(40, samples.length * 2, true);\n\n  floatTo16BitPCM(view, 44, samples);\n\n  return buffer;\n}\n\nexport async function convertWebMBlobToWav(blob: Blob): Promise<Blob> {\n  const arrayBuffer = await blob.arrayBuffer();\n  const audioContext = new AudioContext();\n  const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);\n  const numChannels = audioBuffer.numberOfChannels;\n  const length = audioBuffer.length;\n  const combined = new Float32Array(length);\n\n  for (let channel = 0; channel < numChannels; channel++) {\n    const channelData = audioBuffer.getChannelData(channel);\n    for (let i = 0; i < length; i++) {\n      combined[i] += channelData[i];\n    }\n  }\n\n  for (let i = 0; i < length; i++) {\n    combined[i] /= numChannels;\n  }\n\n  const wavBuffer = encodeWAV(combined, audioBuffer.sampleRate);\n  return new Blob([wavBuffer], { type: \"audio/wav\" });\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAO,SAAS,YAAY,IAAc,EAAE,MAAc,EAAE,GAAW;IACrE,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,MAAM,EAAE,IAAK;QACnC,KAAK,QAAQ,CAAC,SAAS,GAAG,IAAI,UAAU,CAAC;IAC3C;AACF;AAEO,SAAS,gBAAgB,MAAgB,EAAE,MAAc,EAAE,KAAmB;IACnF,IAAK,IAAI,IAAI,GAAG,IAAI,MAAM,MAAM,EAAE,KAAK,UAAU,EAAG;QAClD,MAAM,IAAI,KAAK,GAAG,CAAC,CAAC,GAAG,KAAK,GAAG,CAAC,GAAG,KAAK,CAAC,EAAE;QAC3C,OAAO,QAAQ,CAAC,QAAQ,IAAI,IAAI,IAAI,SAAS,IAAI,QAAQ;IAC3D;AACF;AAEO,SAAS,UAAU,OAAqB,EAAE,UAAkB;IACjE,MAAM,SAAS,IAAI,YAAY,KAAK,QAAQ,MAAM,GAAG;IACrD,MAAM,OAAO,IAAI,SAAS;IAE1B,YAAY,MAAM,GAAG;IACrB,KAAK,SAAS,CAAC,GAAG,KAAK,QAAQ,MAAM,GAAG,GAAG;IAC3C,YAAY,MAAM,GAAG;IACrB,YAAY,MAAM,IAAI;IACtB,KAAK,SAAS,CAAC,IAAI,IAAI;IACvB,KAAK,SAAS,CAAC,IAAI,GAAG;IACtB,KAAK,SAAS,CAAC,IAAI,GAAG;IACtB,KAAK,SAAS,CAAC,IAAI,YAAY;IAC/B,KAAK,SAAS,CAAC,IAAI,aAAa,GAAG;IACnC,KAAK,SAAS,CAAC,IAAI,GAAG;IACtB,KAAK,SAAS,CAAC,IAAI,IAAI;IACvB,YAAY,MAAM,IAAI;IACtB,KAAK,SAAS,CAAC,IAAI,QAAQ,MAAM,GAAG,GAAG;IAEvC,gBAAgB,MAAM,IAAI;IAE1B,OAAO;AACT;AAEO,eAAe,qBAAqB,IAAU;IACnD,MAAM,cAAc,MAAM,KAAK,WAAW;IAC1C,MAAM,eAAe,IAAI;IACzB,MAAM,cAAc,MAAM,aAAa,eAAe,CAAC;IACvD,MAAM,cAAc,YAAY,gBAAgB;IAChD,MAAM,SAAS,YAAY,MAAM;IACjC,MAAM,WAAW,IAAI,aAAa;IAElC,IAAK,IAAI,UAAU,GAAG,UAAU,aAAa,UAAW;QACtD,MAAM,cAAc,YAAY,cAAc,CAAC;QAC/C,IAAK,IAAI,IAAI,GAAG,IAAI,QAAQ,IAAK;YAC/B,QAAQ,CAAC,EAAE,IAAI,WAAW,CAAC,EAAE;QAC/B;IACF;IAEA,IAAK,IAAI,IAAI,GAAG,IAAI,QAAQ,IAAK;QAC/B,QAAQ,CAAC,EAAE,IAAI;IACjB;IAEA,MAAM,YAAY,UAAU,UAAU,YAAY,UAAU;IAC5D,OAAO,IAAI,KAAK;QAAC;KAAU,EAAE;QAAE,MAAM;IAAY;AACnD","debugId":null}},
    {"offset": {"line": 603, "column": 0}, "map": {"version":3,"sources":["file:///Users/christopheprat/Code/Side-projs/Hackathons/code-interview/src/app/voice/hooks/useAudioDownload.ts"],"sourcesContent":["import { useRef } from \"react\";\nimport { convertWebMBlobToWav } from \"@/app/voice/lib/audioUtils\";\n\nfunction useAudioDownload() {\n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\n  const recordedChunksRef = useRef<Blob[]>([]);\n\n  const startRecording = async (remoteStream: MediaStream) => {\n    let micStream: MediaStream;\n    try {\n      micStream = await navigator.mediaDevices.getUserMedia({ audio: true });\n    } catch (err) {\n      console.error(\"Error getting microphone stream:\", err);\n      micStream = new MediaStream();\n    }\n\n    const audioContext = new AudioContext();\n    const destination = audioContext.createMediaStreamDestination();\n\n    try {\n      const remoteSource = audioContext.createMediaStreamSource(remoteStream);\n      remoteSource.connect(destination);\n    } catch (err) {\n      console.error(\"Unable to connect remote stream:\", err);\n    }\n\n    try {\n      const micSource = audioContext.createMediaStreamSource(micStream);\n      micSource.connect(destination);\n    } catch (err) {\n      console.error(\"Unable to connect microphone stream:\", err);\n    }\n\n    const options = { mimeType: \"audio/webm\" };\n    try {\n      const mediaRecorder = new MediaRecorder(destination.stream, options);\n      mediaRecorder.ondataavailable = (event: BlobEvent) => {\n        if (event.data && event.data.size > 0) {\n          recordedChunksRef.current.push(event.data);\n        }\n      };\n      mediaRecorder.start();\n      mediaRecorderRef.current = mediaRecorder;\n    } catch (err) {\n      console.error(\"Error starting MediaRecorder:\", err);\n    }\n  };\n\n  const stopRecording = () => {\n    if (!mediaRecorderRef.current) return;\n    mediaRecorderRef.current.requestData();\n    mediaRecorderRef.current.stop();\n    mediaRecorderRef.current = null;\n  };\n\n  const downloadRecording = async () => {\n    if (mediaRecorderRef.current?.state === \"recording\") {\n      mediaRecorderRef.current.requestData();\n      await new Promise((resolve) => setTimeout(resolve, 100));\n    }\n\n    if (recordedChunksRef.current.length === 0) {\n      console.warn(\"No recorded audio chunks available\");\n      return;\n    }\n\n    const webmBlob = new Blob(recordedChunksRef.current, {\n      type: \"audio/webm\",\n    });\n\n    try {\n      const wavBlob = await convertWebMBlobToWav(webmBlob);\n      const url = URL.createObjectURL(wavBlob);\n      const now = new Date().toISOString().replace(/[:.]/g, \"-\");\n\n      const a = document.createElement(\"a\");\n      a.href = url;\n      a.download = `voice-agent-${now}.wav`;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      setTimeout(() => URL.revokeObjectURL(url), 100);\n    } catch (err) {\n      console.error(\"Failed to convert WebM to WAV:\", err);\n    }\n  };\n\n  return { startRecording, stopRecording, downloadRecording };\n}\n\nexport default useAudioDownload;\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;AAEA,SAAS;;IACP,MAAM,mBAAmB,IAAA,8UAAM,EAAuB;IACtD,MAAM,oBAAoB,IAAA,8UAAM,EAAS,EAAE;IAE3C,MAAM,iBAAiB,OAAO;QAC5B,IAAI;QACJ,IAAI;YACF,YAAY,MAAM,UAAU,YAAY,CAAC,YAAY,CAAC;gBAAE,OAAO;YAAK;QACtE,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,oCAAoC;YAClD,YAAY,IAAI;QAClB;QAEA,MAAM,eAAe,IAAI;QACzB,MAAM,cAAc,aAAa,4BAA4B;QAE7D,IAAI;YACF,MAAM,eAAe,aAAa,uBAAuB,CAAC;YAC1D,aAAa,OAAO,CAAC;QACvB,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,oCAAoC;QACpD;QAEA,IAAI;YACF,MAAM,YAAY,aAAa,uBAAuB,CAAC;YACvD,UAAU,OAAO,CAAC;QACpB,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,wCAAwC;QACxD;QAEA,MAAM,UAAU;YAAE,UAAU;QAAa;QACzC,IAAI;YACF,MAAM,gBAAgB,IAAI,cAAc,YAAY,MAAM,EAAE;YAC5D,cAAc,eAAe,GAAG,CAAC;gBAC/B,IAAI,MAAM,IAAI,IAAI,MAAM,IAAI,CAAC,IAAI,GAAG,GAAG;oBACrC,kBAAkB,OAAO,CAAC,IAAI,CAAC,MAAM,IAAI;gBAC3C;YACF;YACA,cAAc,KAAK;YACnB,iBAAiB,OAAO,GAAG;QAC7B,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,iCAAiC;QACjD;IACF;IAEA,MAAM,gBAAgB;QACpB,IAAI,CAAC,iBAAiB,OAAO,EAAE;QAC/B,iBAAiB,OAAO,CAAC,WAAW;QACpC,iBAAiB,OAAO,CAAC,IAAI;QAC7B,iBAAiB,OAAO,GAAG;IAC7B;IAEA,MAAM,oBAAoB;YACpB;QAAJ,IAAI,EAAA,4BAAA,iBAAiB,OAAO,cAAxB,gDAAA,0BAA0B,KAAK,MAAK,aAAa;YACnD,iBAAiB,OAAO,CAAC,WAAW;YACpC,MAAM,IAAI,QAAQ,CAAC,UAAY,WAAW,SAAS;QACrD;QAEA,IAAI,kBAAkB,OAAO,CAAC,MAAM,KAAK,GAAG;YAC1C,QAAQ,IAAI,CAAC;YACb;QACF;QAEA,MAAM,WAAW,IAAI,KAAK,kBAAkB,OAAO,EAAE;YACnD,MAAM;QACR;QAEA,IAAI;YACF,MAAM,UAAU,MAAM,IAAA,mKAAoB,EAAC;YAC3C,MAAM,MAAM,IAAI,eAAe,CAAC;YAChC,MAAM,MAAM,IAAI,OAAO,WAAW,GAAG,OAAO,CAAC,SAAS;YAEtD,MAAM,IAAI,SAAS,aAAa,CAAC;YACjC,EAAE,IAAI,GAAG;YACT,EAAE,QAAQ,GAAG,AAAC,eAAkB,OAAJ,KAAI;YAChC,SAAS,IAAI,CAAC,WAAW,CAAC;YAC1B,EAAE,KAAK;YACP,SAAS,IAAI,CAAC,WAAW,CAAC;YAC1B,WAAW,IAAM,IAAI,eAAe,CAAC,MAAM;QAC7C,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,kCAAkC;QAClD;IACF;IAEA,OAAO;QAAE;QAAgB;QAAe;IAAkB;AAC5D;GArFS;uCAuFM","debugId":null}},
    {"offset": {"line": 705, "column": 0}, "map": {"version":3,"sources":["file:///Users/christopheprat/Code/Side-projs/Hackathons/code-interview/src/app/voice/components/Transcript.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useRef, useState } from \"react\";\nimport ReactMarkdown from \"react-markdown\";\nimport { useTranscript } from \"@/app/voice/contexts/TranscriptContext\";\n\ninterface TranscriptProps {\n  userText: string;\n  setUserText: (val: string) => void;\n  onSendMessage: () => void;\n  canSend: boolean;\n  downloadRecording: () => void;\n}\n\nexport function Transcript({\n  userText,\n  setUserText,\n  onSendMessage,\n  canSend,\n  downloadRecording,\n}: TranscriptProps) {\n  const { transcriptItems, toggleTranscriptItemExpand } = useTranscript();\n  const transcriptRef = useRef<HTMLDivElement | null>(null);\n  const [previousItemsLength, setPreviousItemsLength] = useState(0);\n  const [justCopied, setJustCopied] = useState(false);\n  const inputRef = useRef<HTMLInputElement | null>(null);\n\n  useEffect(() => {\n    if (!transcriptRef.current) return;\n    if (transcriptItems.length !== previousItemsLength) {\n      transcriptRef.current.scrollTop = transcriptRef.current.scrollHeight;\n      setPreviousItemsLength(transcriptItems.length);\n    }\n  }, [transcriptItems, previousItemsLength]);\n\n  useEffect(() => {\n    if (canSend && inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, [canSend]);\n\n  const handleCopyTranscript = async () => {\n    if (!transcriptRef.current) return;\n    try {\n      await navigator.clipboard.writeText(transcriptRef.current.innerText);\n      setJustCopied(true);\n      setTimeout(() => setJustCopied(false), 1500);\n    } catch (error) {\n      console.error(\"Failed to copy transcript\", error);\n    }\n  };\n\n  return (\n    <div className=\"flex flex-col flex-1 bg-white min-h-0 rounded-xl\">\n      <div className=\"flex items-center justify-between px-6 py-3 sticky top-0 z-10 border-b bg-white rounded-t-xl\">\n        <span className=\"font-semibold\">Transcript</span>\n        <div className=\"flex gap-x-2\">\n          <button\n            onClick={handleCopyTranscript}\n            className=\"text-sm px-3 py-1 rounded-md bg-gray-200 hover:bg-gray-300\"\n          >\n            {justCopied ? \"Copied!\" : \"Copy\"}\n          </button>\n          <button\n            onClick={downloadRecording}\n            className=\"text-sm px-3 py-1 rounded-md bg-gray-200 hover:bg-gray-300\"\n          >\n            Download Audio\n          </button>\n        </div>\n      </div>\n\n      <div\n        ref={transcriptRef}\n        className=\"overflow-auto p-4 flex flex-col gap-y-4 h-full\"\n      >\n        {[...transcriptItems]\n          .sort((a, b) => a.createdAtMs - b.createdAtMs)\n          .map((item) => {\n            if (item.isHidden) return null;\n\n            if (item.type === \"MESSAGE\") {\n              const isUser = item.role === \"user\";\n              const containerClass = `flex flex-col ${\n                isUser ? \"items-end\" : \"items-start\"\n              }`;\n              const bubbleClass = `max-w-lg p-3 rounded-2xl ${\n                isUser\n                  ? \"bg-gray-900 text-white rounded-br-none\"\n                  : \"bg-gray-100 text-gray-900 rounded-bl-none\"\n              }`;\n\n              const content = item.title ?? \"\";\n              const isBracketed = content.startsWith(\"[\") && content.endsWith(\"]\");\n              const display = isBracketed ? content.slice(1, -1) : content;\n\n              return (\n                <div key={item.itemId} className={containerClass}>\n                  <div className={bubbleClass}>\n                    <div className=\"text-xs text-gray-400 font-mono mb-1\">\n                      {item.timestamp}\n                    </div>\n                    <div className={`whitespace-pre-wrap ${isBracketed ? \"italic text-gray-300\" : \"\"}`}>\n                      <ReactMarkdown>{display}</ReactMarkdown>\n                    </div>\n                  </div>\n                </div>\n              );\n            }\n\n            if (item.type === \"BREADCRUMB\") {\n              return (\n                <div\n                  key={item.itemId}\n                  className=\"flex flex-col text-sm text-gray-600\"\n                >\n                  <span className=\"text-xs font-mono text-gray-400\">\n                    {item.timestamp}\n                  </span>\n                  <div\n                    className={`whitespace-pre-wrap font-mono cursor-pointer ${\n                      item.data ? \"flex items-center\" : \"\"\n                    }`}\n                    onClick={() => item.data && toggleTranscriptItemExpand(item.itemId)}\n                  >\n                    {item.data && (\n                      <span\n                        className={`mr-2 transition-transform duration-200 ${\n                          item.expanded ? \"rotate-90\" : \"rotate-0\"\n                        }`}\n                      >\n                        ▶\n                      </span>\n                    )}\n                    {item.title}\n                  </div>\n                  {item.expanded && item.data && (\n                    <pre className=\"border-l-2 border-gray-200 ml-1 pl-2 text-xs text-gray-800 whitespace-pre-wrap\">\n                      {JSON.stringify(item.data, null, 2)}\n                    </pre>\n                  )}\n                </div>\n              );\n            }\n\n            return (\n              <div key={item.itemId} className=\"text-gray-500 text-xs\">\n                Unknown item type\n              </div>\n            );\n          })}\n      </div>\n\n      <div className=\"p-4 flex items-center gap-x-2 border-t border-gray-200\">\n        <input\n          ref={inputRef}\n          type=\"text\"\n          value={userText}\n          onChange={(e) => setUserText(e.target.value)}\n          onKeyDown={(e) => {\n            if (e.key === \"Enter\" && canSend) {\n              onSendMessage();\n            }\n          }}\n          placeholder=\"Type a message...\"\n          className=\"flex-1 px-4 py-2 border rounded-lg focus:outline-none\"\n        />\n        <button\n          onClick={onSendMessage}\n          disabled={!canSend || !userText.trim()}\n          className=\"bg-gray-900 text-white px-4 py-2 rounded-lg disabled:opacity-50\"\n        >\n          Send\n        </button>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 977, "column": 0}, "map": {"version":3,"sources":["file:///Users/christopheprat/Code/Side-projs/Hackathons/code-interview/src/app/voice/components/Events.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useRef, useState } from \"react\";\nimport { useEvent } from \"@/app/voice/contexts/EventContext\";\n\ninterface EventsProps {\n  isExpanded: boolean;\n}\n\nexport function Events({ isExpanded }: EventsProps) {\n  const { loggedEvents, toggleExpand } = useEvent();\n  const containerRef = useRef<HTMLDivElement | null>(null);\n  const [previousCount, setPreviousCount] = useState(0);\n\n  useEffect(() => {\n    if (!containerRef.current) return;\n    const hasNew = loggedEvents.length > previousCount;\n    if (isExpanded && hasNew) {\n      containerRef.current.scrollTop = containerRef.current.scrollHeight;\n    }\n    setPreviousCount(loggedEvents.length);\n  }, [loggedEvents, isExpanded, previousCount]);\n\n  const arrowForDirection = (direction: string) => {\n    switch (direction) {\n      case \"client\":\n        return { symbol: \"▲\", color: \"#7f5af0\" };\n      case \"server\":\n        return { symbol: \"▼\", color: \"#2cb67d\" };\n      default:\n        return { symbol: \"•\", color: \"#999\" };\n    }\n  };\n\n  return (\n    <div\n      ref={containerRef}\n      className={`${\n        isExpanded ? \"w-1/2 opacity-100\" : \"w-0 opacity-0\"\n      } transition-all duration-200 ease-in-out bg-white rounded-xl overflow-hidden`}\n    >\n      {isExpanded && (\n        <div className=\"flex flex-col h-full\">\n          <div className=\"px-6 py-3 border-b font-semibold\">Logs</div>\n          <div className=\"flex-1 overflow-auto\">\n            {loggedEvents.map((event) => {\n              const arrow = arrowForDirection(event.direction);\n              const isError =\n                event.eventName.toLowerCase().includes(\"error\") ||\n                Boolean(event.eventData?.response?.status_details?.error);\n\n              return (\n                <div\n                  key={event.id}\n                  className=\"border-b border-gray-200 px-6 py-2 text-sm font-mono\"\n                >\n                  <div\n                    className=\"flex items-center justify-between cursor-pointer\"\n                    onClick={() => toggleExpand(event.id)}\n                  >\n                    <div className=\"flex items-center gap-2 flex-1\">\n                      <span style={{ color: arrow.color }}>{arrow.symbol}</span>\n                      <span className={isError ? \"text-red-600\" : \"text-gray-800\"}>\n                        {event.eventName || \"(unnamed)\"}\n                      </span>\n                    </div>\n                    <span className=\"text-xs text-gray-500\">\n                      {event.timestamp}\n                    </span>\n                  </div>\n                  {event.expanded && (\n                    <pre className=\"text-xs text-gray-800 whitespace-pre-wrap break-words border-l-2 border-gray-200 mt-2 pl-2\">\n                      {JSON.stringify(event.eventData, null, 2)}\n                    </pre>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;AAHA;;;AASO,SAAS,OAAO,KAA2B;QAA3B,EAAE,UAAU,EAAe,GAA3B;;IACrB,MAAM,EAAE,YAAY,EAAE,YAAY,EAAE,GAAG,IAAA,+JAAQ;IAC/C,MAAM,eAAe,IAAA,8UAAM,EAAwB;IACnD,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,gVAAQ,EAAC;IAEnD,IAAA,iVAAS;4BAAC;YACR,IAAI,CAAC,aAAa,OAAO,EAAE;YAC3B,MAAM,SAAS,aAAa,MAAM,GAAG;YACrC,IAAI,cAAc,QAAQ;gBACxB,aAAa,OAAO,CAAC,SAAS,GAAG,aAAa,OAAO,CAAC,YAAY;YACpE;YACA,iBAAiB,aAAa,MAAM;QACtC;2BAAG;QAAC;QAAc;QAAY;KAAc;IAE5C,MAAM,oBAAoB,CAAC;QACzB,OAAQ;YACN,KAAK;gBACH,OAAO;oBAAE,QAAQ;oBAAK,OAAO;gBAAU;YACzC,KAAK;gBACH,OAAO;oBAAE,QAAQ;oBAAK,OAAO;gBAAU;YACzC;gBACE,OAAO;oBAAE,QAAQ;oBAAK,OAAO;gBAAO;QACxC;IACF;IAEA,qBACE,oWAAC;QACC,KAAK;QACL,WAAW,AAAC,GAEX,OADC,aAAa,sBAAsB,iBACpC;kBAEA,4BACC,oWAAC;YAAI,WAAU;;8BACb,oWAAC;oBAAI,WAAU;8BAAmC;;;;;;8BAClD,oWAAC;oBAAI,WAAU;8BACZ,aAAa,GAAG,CAAC,CAAC;4BAIP,0CAAA,2BAAA;wBAHV,MAAM,QAAQ,kBAAkB,MAAM,SAAS;wBAC/C,MAAM,UACJ,MAAM,SAAS,CAAC,WAAW,GAAG,QAAQ,CAAC,YACvC,SAAQ,mBAAA,MAAM,SAAS,cAAf,wCAAA,4BAAA,iBAAiB,QAAQ,cAAzB,iDAAA,2CAAA,0BAA2B,cAAc,cAAzC,+DAAA,yCAA2C,KAAK;wBAE1D,qBACE,oWAAC;4BAEC,WAAU;;8CAEV,oWAAC;oCACC,WAAU;oCACV,SAAS,IAAM,aAAa,MAAM,EAAE;;sDAEpC,oWAAC;4CAAI,WAAU;;8DACb,oWAAC;oDAAK,OAAO;wDAAE,OAAO,MAAM,KAAK;oDAAC;8DAAI,MAAM,MAAM;;;;;;8DAClD,oWAAC;oDAAK,WAAW,UAAU,iBAAiB;8DACzC,MAAM,SAAS,IAAI;;;;;;;;;;;;sDAGxB,oWAAC;4CAAK,WAAU;sDACb,MAAM,SAAS;;;;;;;;;;;;gCAGnB,MAAM,QAAQ,kBACb,oWAAC;oCAAI,WAAU;8CACZ,KAAK,SAAS,CAAC,MAAM,SAAS,EAAE,MAAM;;;;;;;2BAnBtC,MAAM,EAAE;;;;;oBAwBnB;;;;;;;;;;;;;;;;;AAMZ;GA1EgB;;QACyB,+JAAQ;;;KADjC","debugId":null}},
    {"offset": {"line": 1143, "column": 0}, "map": {"version":3,"sources":["file:///Users/christopheprat/Code/Side-projs/Hackathons/code-interview/src/app/voice/components/BottomToolbar.tsx"],"sourcesContent":["import React from \"react\";\nimport { SessionStatus } from \"@/app/voice/types\";\n\ninterface BottomToolbarProps {\n  sessionStatus: SessionStatus;\n  onToggleConnection: () => void;\n  isPTTActive: boolean;\n  setIsPTTActive: (value: boolean) => void;\n  isPTTUserSpeaking: boolean;\n  handleTalkButtonDown: () => void;\n  handleTalkButtonUp: () => void;\n  isEventsPaneExpanded: boolean;\n  setIsEventsPaneExpanded: (value: boolean) => void;\n  isAudioPlaybackEnabled: boolean;\n  setIsAudioPlaybackEnabled: (value: boolean) => void;\n}\n\nexport function BottomToolbar({\n  sessionStatus,\n  onToggleConnection,\n  isPTTActive,\n  setIsPTTActive,\n  isPTTUserSpeaking,\n  handleTalkButtonDown,\n  handleTalkButtonUp,\n  isEventsPaneExpanded,\n  setIsEventsPaneExpanded,\n  isAudioPlaybackEnabled,\n  setIsAudioPlaybackEnabled,\n}: BottomToolbarProps) {\n  const isConnected = sessionStatus === \"CONNECTED\";\n  const isConnecting = sessionStatus === \"CONNECTING\";\n\n  const connectionLabel = isConnected\n    ? \"Disconnect\"\n    : isConnecting\n      ? \"Connecting...\"\n      : \"Connect\";\n\n  return (\n    <div className=\"p-4 flex flex-row items-center justify-center gap-6 bg-white border-t\">\n      <button\n        onClick={onToggleConnection}\n        disabled={isConnecting}\n        className={`px-6 py-2 rounded-md text-white ${\n          isConnected ? \"bg-red-600 hover:bg-red-700\" : \"bg-black hover:bg-gray-900\"\n        } ${isConnecting ? \"cursor-not-allowed opacity-70\" : \"\"}`}\n      >\n        {connectionLabel}\n      </button>\n\n      <label className=\"flex items-center gap-2\">\n        <input\n          type=\"checkbox\"\n          checked={isPTTActive}\n          onChange={(e) => setIsPTTActive(e.target.checked)}\n          disabled={!isConnected}\n        />\n        Push to Talk\n      </label>\n      <button\n        onMouseDown={handleTalkButtonDown}\n        onMouseUp={handleTalkButtonUp}\n        onTouchStart={handleTalkButtonDown}\n        onTouchEnd={handleTalkButtonUp}\n        disabled={!isPTTActive}\n        className={`px-4 py-2 rounded-md ${\n          isPTTActive ? \"bg-gray-200 hover:bg-gray-300\" : \"bg-gray-100 text-gray-500\"\n        } ${isPTTUserSpeaking ? \"ring-2 ring-gray-400\" : \"\"}`}\n      >\n        Talk\n      </button>\n\n      <label className=\"flex items-center gap-2\">\n        <input\n          type=\"checkbox\"\n          checked={isAudioPlaybackEnabled}\n          onChange={(e) => setIsAudioPlaybackEnabled(e.target.checked)}\n          disabled={!isConnected}\n        />\n        Audio Playback\n      </label>\n\n      <label className=\"flex items-center gap-2\">\n        <input\n          type=\"checkbox\"\n          checked={isEventsPaneExpanded}\n          onChange={(e) => setIsEventsPaneExpanded(e.target.checked)}\n        />\n        Show Logs\n      </label>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;;AAiBO,SAAS,cAAc,KAYT;QAZS,EAC5B,aAAa,EACb,kBAAkB,EAClB,WAAW,EACX,cAAc,EACd,iBAAiB,EACjB,oBAAoB,EACpB,kBAAkB,EAClB,oBAAoB,EACpB,uBAAuB,EACvB,sBAAsB,EACtB,yBAAyB,EACN,GAZS;IAa5B,MAAM,cAAc,kBAAkB;IACtC,MAAM,eAAe,kBAAkB;IAEvC,MAAM,kBAAkB,cACpB,eACA,eACE,kBACA;IAEN,qBACE,oWAAC;QAAI,WAAU;;0BACb,oWAAC;gBACC,SAAS;gBACT,UAAU;gBACV,WAAW,AAAC,mCAER,OADF,cAAc,gCAAgC,8BAC/C,KAAuD,OAApD,eAAe,kCAAkC;0BAEpD;;;;;;0BAGH,oWAAC;gBAAM,WAAU;;kCACf,oWAAC;wBACC,MAAK;wBACL,SAAS;wBACT,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,OAAO;wBAChD,UAAU,CAAC;;;;;;oBACX;;;;;;;0BAGJ,oWAAC;gBACC,aAAa;gBACb,WAAW;gBACX,cAAc;gBACd,YAAY;gBACZ,UAAU,CAAC;gBACX,WAAW,AAAC,wBAER,OADF,cAAc,kCAAkC,6BACjD,KAAmD,OAAhD,oBAAoB,yBAAyB;0BAClD;;;;;;0BAID,oWAAC;gBAAM,WAAU;;kCACf,oWAAC;wBACC,MAAK;wBACL,SAAS;wBACT,UAAU,CAAC,IAAM,0BAA0B,EAAE,MAAM,CAAC,OAAO;wBAC3D,UAAU,CAAC;;;;;;oBACX;;;;;;;0BAIJ,oWAAC;gBAAM,WAAU;;kCACf,oWAAC;wBACC,MAAK;wBACL,SAAS;wBACT,UAAU,CAAC,IAAM,wBAAwB,EAAE,MAAM,CAAC,OAAO;;;;;;oBACzD;;;;;;;;;;;;;AAKV;KA5EgB","debugId":null}},
    {"offset": {"line": 1256, "column": 0}, "map": {"version":3,"sources":["file:///Users/christopheprat/Code/Side-projs/Hackathons/code-interview/src/app/voice/App.tsx"],"sourcesContent":["\"use client\";\n\nimport React, {\n    useEffect,\n    useMemo,\n    useRef,\n    useState,\n    useCallback,\n} from \"react\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { useTranscript } from \"@/app/voice/contexts/TranscriptContext\";\nimport { useEvent } from \"@/app/voice/contexts/EventContext\";\nimport { useRealtimeSession } from \"@/app/voice/hooks/useRealtimeSession\";\nimport useAudioDownload from \"@/app/voice/hooks/useAudioDownload\";\nimport { Transcript } from \"@/app/voice/components/Transcript\";\nimport { Events } from \"@/app/voice/components/Events\";\nimport { BottomToolbar } from \"@/app/voice/components/BottomToolbar\";\nimport { RealtimeAgent } from \"@openai/agents/realtime\";\n\nconst DEFAULT_VOICE = process.env.NEXT_PUBLIC_REALTIME_VOICE ?? \"verse\";\n\nconst VOICE_AGENT = new RealtimeAgent({\n    name: \"voice_assistant\",\n    voice: DEFAULT_VOICE,\n    instructions:\n        \"You are a friendly interview coach. Speak conversationally, keep responses concise, and help candidates practice describing their experience.\",\n});\n\nexport function VoiceApp() {\n    const { addTranscriptMessage, addTranscriptBreadcrumb } = useTranscript();\n    const { logClientEvent, logServerEvent } = useEvent();\n\n    const audioElementRef = useRef<HTMLAudioElement | null>(null);\n\n    const sdkAudioElement = useMemo(() => {\n        if (typeof window === \"undefined\") return undefined;\n        const el = document.createElement(\"audio\");\n        el.autoplay = true;\n        el.style.display = \"none\";\n        document.body.appendChild(el);\n        return el;\n    }, []);\n\n    useEffect(() => {\n        if (sdkAudioElement && !audioElementRef.current) {\n            audioElementRef.current = sdkAudioElement;\n        }\n    }, [sdkAudioElement]);\n\n    const {\n        status: sessionStatus,\n        connect,\n        disconnect,\n        sendUserText,\n        sendEvent,\n        mute,\n        interrupt,\n    } = useRealtimeSession();\n\n    const [userText, setUserText] = useState(\"\");\n    const [isEventsPaneExpanded, setIsEventsPaneExpanded] = useState(true);\n    const [isPTTActive, setIsPTTActive] = useState(false);\n    const [isPTTUserSpeaking, setIsPTTUserSpeaking] = useState(false);\n    const [isAudioPlaybackEnabled, setIsAudioPlaybackEnabled] = useState(() => {\n        if (typeof window === \"undefined\") return true;\n        const stored = window.localStorage.getItem(\"voice-audio-playback\");\n        return stored ? stored === \"true\" : true;\n    });\n\n    const { startRecording, stopRecording, downloadRecording } =\n        useAudioDownload();\n\n    useEffect(() => {\n        if (typeof window === \"undefined\") return;\n        const storedPTT = window.localStorage.getItem(\"voice-ptt-active\");\n        if (storedPTT) setIsPTTActive(storedPTT === \"true\");\n        const storedLogs = window.localStorage.getItem(\"voice-logs-open\");\n        if (storedLogs) setIsEventsPaneExpanded(storedLogs === \"true\");\n    }, []);\n\n    useEffect(() => {\n        if (typeof window === \"undefined\") return;\n        window.localStorage.setItem(\"voice-ptt-active\", String(isPTTActive));\n    }, [isPTTActive]);\n\n    useEffect(() => {\n        if (typeof window === \"undefined\") return;\n        window.localStorage.setItem(\n            \"voice-logs-open\",\n            String(isEventsPaneExpanded),\n        );\n    }, [isEventsPaneExpanded]);\n\n    useEffect(() => {\n        if (typeof window === \"undefined\") return;\n        window.localStorage.setItem(\n            \"voice-audio-playback\",\n            String(isAudioPlaybackEnabled),\n        );\n    }, [isAudioPlaybackEnabled]);\n\n    useEffect(() => {\n        const el = audioElementRef.current;\n        if (!el) return;\n        if (isAudioPlaybackEnabled) {\n            el.muted = false;\n            el.play().catch((err) => {\n                console.warn(\"Autoplay blocked\", err);\n            });\n        } else {\n            el.muted = true;\n            el.pause();\n        }\n        mute(!isAudioPlaybackEnabled);\n    }, [isAudioPlaybackEnabled, mute]);\n\n    useEffect(() => {\n        if (\n            sessionStatus === \"CONNECTED\" &&\n            audioElementRef.current?.srcObject\n        ) {\n            const remoteStream = audioElementRef.current\n                .srcObject as MediaStream;\n            startRecording(remoteStream);\n            return () => {\n                stopRecording();\n            };\n        }\n        return undefined;\n    }, [sessionStatus, startRecording, stopRecording]);\n\n    const fetchEphemeralKey = useCallback(async () => {\n        logClientEvent({ url: \"/api/session\" }, \"fetch_session_token_request\");\n        const response = await fetch(\"/api/session\", { method: \"POST\" });\n        const data = await response.json();\n        logServerEvent(data, \"fetch_session_token_response\");\n\n        if (!response.ok) {\n            const message =\n                typeof data?.error === \"string\"\n                    ? data.error\n                    : \"Failed to create session\";\n            throw new Error(message);\n        }\n\n        const key = data?.client_secret?.value;\n        if (!key) {\n            throw new Error(\"No ephemeral key returned\");\n        }\n        return key as string;\n    }, [logClientEvent, logServerEvent]);\n\n    const sendClientEvent = useCallback(\n        (eventObj: Record<string, unknown>, suffix = \"\") => {\n            try {\n                sendEvent(eventObj);\n                logClientEvent(eventObj, suffix);\n            } catch (err) {\n                console.error(\"Failed to send event\", err);\n            }\n        },\n        [sendEvent, logClientEvent],\n    );\n\n    const sendSimulatedUserMessage = useCallback(\n        (text: string) => {\n            const id = uuidv4().slice(0, 32);\n            addTranscriptMessage(id, \"user\", text, true);\n            sendClientEvent(\n                {\n                    type: \"conversation.item.create\",\n                    item: {\n                        id,\n                        type: \"message\",\n                        role: \"user\",\n                        content: [{ type: \"input_text\", text }],\n                    },\n                },\n                \"(simulated user text message)\",\n            );\n            sendClientEvent({ type: \"response.create\" }, \"(auto greet)\");\n        },\n        [addTranscriptMessage, sendClientEvent],\n    );\n\n    const updateSession = useCallback(\n        (shouldPrompt = false) => {\n            const turnDetection = isPTTActive\n                ? null\n                : {\n                      type: \"server_vad\",\n                      threshold: 0.9,\n                      prefix_padding_ms: 300,\n                      silence_duration_ms: 500,\n                      create_response: true,\n                  };\n\n            sendClientEvent({\n                type: \"session.update\",\n                session: {\n                    turn_detection: turnDetection,\n                },\n            });\n\n            if (shouldPrompt) {\n                sendSimulatedUserMessage(\"hi\");\n            }\n        },\n        [isPTTActive, sendClientEvent, sendSimulatedUserMessage],\n    );\n\n    const connectToRealtime = useCallback(async () => {\n        if (sessionStatus !== \"DISCONNECTED\") return;\n        try {\n            const EPHEMERAL_KEY = await fetchEphemeralKey();\n            if (!EPHEMERAL_KEY) {\n                console.error(\"Failed to fetch ephemeral key\");\n                return;\n            }\n            console.log(EPHEMERAL_KEY);\n            await connect({\n                getEphemeralKey: async () => EPHEMERAL_KEY,\n                agent: VOICE_AGENT,\n                audioElement: sdkAudioElement,\n                extraContext: {\n                    addTranscriptBreadcrumb,\n                },\n            });\n            updateSession(true);\n        } catch (err) {\n            console.error(\"Error connecting to realtime session\", err);\n        }\n    }, [\n        sessionStatus,\n        connect,\n        fetchEphemeralKey,\n        sdkAudioElement,\n        addTranscriptBreadcrumb,\n        updateSession,\n    ]);\n\n    const disconnectFromRealtime = useCallback(() => {\n        disconnect();\n        setIsPTTUserSpeaking(false);\n    }, [disconnect]);\n\n    useEffect(() => {\n        if (sessionStatus === \"CONNECTED\") {\n            updateSession(false);\n        }\n    }, [sessionStatus, updateSession, isPTTActive]);\n\n    const handleSendTextMessage = useCallback(() => {\n        if (!userText.trim()) return;\n        interrupt();\n        try {\n            sendUserText(userText.trim());\n            logClientEvent({ type: \"user_message\", text: userText.trim() });\n        } catch (err) {\n            console.error(\"Failed to send user text\", err);\n        }\n        setUserText(\"\");\n    }, [userText, interrupt, sendUserText, logClientEvent]);\n\n    const handleTalkButtonDown = useCallback(() => {\n        if (sessionStatus !== \"CONNECTED\") return;\n        interrupt();\n        setIsPTTUserSpeaking(true);\n        sendClientEvent(\n            { type: \"input_audio_buffer.clear\" },\n            \"clear PTT buffer\",\n        );\n    }, [sessionStatus, interrupt, sendClientEvent]);\n\n    const handleTalkButtonUp = useCallback(() => {\n        if (sessionStatus !== \"CONNECTED\" || !isPTTUserSpeaking) return;\n        setIsPTTUserSpeaking(false);\n        sendClientEvent({ type: \"input_audio_buffer.commit\" }, \"commit PTT\");\n        sendClientEvent({ type: \"response.create\" }, \"trigger response PTT\");\n    }, [sessionStatus, isPTTUserSpeaking, sendClientEvent]);\n\n    const handleToggleConnection = useCallback(() => {\n        if (sessionStatus === \"CONNECTED\" || sessionStatus === \"CONNECTING\") {\n            disconnectFromRealtime();\n        } else {\n            connectToRealtime();\n        }\n    }, [sessionStatus, disconnectFromRealtime, connectToRealtime]);\n\n    return (\n        <div className=\"flex flex-col h-screen bg-gray-100 text-gray-800\">\n            <div className=\"px-5 py-4 text-lg font-semibold border-b bg-white flex items-center justify-between\">\n                <span>Realtime Voice Agent</span>\n                <span className=\"text-sm text-gray-500\">\n                    Status: {sessionStatus}\n                </span>\n            </div>\n            <div className=\"flex flex-1 gap-2 px-2 py-2 overflow-hidden\">\n                <Transcript\n                    userText={userText}\n                    setUserText={setUserText}\n                    onSendMessage={handleSendTextMessage}\n                    canSend={sessionStatus === \"CONNECTED\"}\n                    downloadRecording={downloadRecording}\n                />\n                <Events isExpanded={isEventsPaneExpanded} />\n            </div>\n            <BottomToolbar\n                sessionStatus={sessionStatus}\n                onToggleConnection={handleToggleConnection}\n                isPTTActive={isPTTActive}\n                setIsPTTActive={setIsPTTActive}\n                isPTTUserSpeaking={isPTTUserSpeaking}\n                handleTalkButtonDown={handleTalkButtonDown}\n                handleTalkButtonUp={handleTalkButtonUp}\n                isEventsPaneExpanded={isEventsPaneExpanded}\n                setIsEventsPaneExpanded={setIsEventsPaneExpanded}\n                isAudioPlaybackEnabled={isAudioPlaybackEnabled}\n                setIsAudioPlaybackEnabled={setIsAudioPlaybackEnabled}\n            />\n        </div>\n    );\n}\n\nexport default VoiceApp;\n"],"names":[],"mappings":"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","debugId":null}}]
}